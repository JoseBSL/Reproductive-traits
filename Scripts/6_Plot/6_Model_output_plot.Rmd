---
title: "Visitation_stacked_barplot"
output:
  pdf_document: default
  html_document: default
---


```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=7, fig.width=8}
library(dplyr)
library(tidyr)
library(plyr)
library(ggplot2)
library(reshape2)
library(scales)
library(devtools)
library(png)
library(grid)
library(gridExtra)
library(jpeg)
dev_mode(on=T)

setwd("~/R_Projects/Reproductive Traits")

img <- readPNG(system.file("img", "Rlogo.png", package="png"))
g <- rasterGrob(img, interpolate=TRUE)


net_long_1 <- readRDS("Data/RData/species_per_order_percentage.RData")

legend_title <- "Taxonomic groups"

la <- c("Ramirez 1989", "Ramirez 1992", "Bartomeus unp. 2015", "Chacoff 2011","Bartomeus 2008 1", "Bartomeus 2008 2", "Robertson 1929", "Small 1976","Inouye 1990", "Souza 2018", "Bundgaard 2003", "Inouye 1988", "Dupont 2009 1", "Olesen 2002 1", "Fang huang 2012", "mcmullen 1993", "Olesen 2002 2", "Dicks 2002","Elberling 1999", "Primack 1983 1", "Primack 1983 2", "Kato 2000", "Kaiser-Bunbunry 2009", "Traveset 2013", "Kevan 1970", "Bek 2006","Primack 1983 3", "Kaiser-Bunbury 2014", "Dupont 2009 2", "Lundgren 2005")


 get_png <- function(filename) {
  grid::rasterGrob(png::readPNG(filename), interpolate = TRUE)
}


 
l <- get_png("Images/lepidoptera_2.png")
bumb <- get_png("Images/bumblebee.png")
dip <- get_png("Images/diptera.png")
beet <- get_png("Images/beetle.png")
hem<- get_png("Images/hemiptera.png")

t <- grid::roundrectGrob(x=0.5, y=0.5, width=1, height=1)


p<- ggplot(net_long_1) +
  aes(x = reorder(Id,-order), 
      y = measurement, 
      fill =factor(orders, levels=c("Hemiptera","Coleoptera","Lepidoptera","Diptera", "Hymenoptera"))) +
  geom_bar(position = "fill", stat = "identity", alpha=0.6) +coord_flip() +scale_x_discrete(labels= la) + 
  scale_fill_manual(legend_title,values=c("indianred", "gray49", "seagreen", "darkgoldenrod2", "#386cb0")) + theme_classic()+xlab("Networks")+ylab("Species per order") +scale_y_continuous(labels = scales::percent) + theme(legend.background = element_rect(fill=alpha('blue', 0.0)))+
  annotation_custom(l, xmin = 14.6, xmax = 15.4, ymin = 1.03, ymax =1.09) + annotation_custom(bumb, xmin = 11.6, xmax = 13.9, ymin = 1.03, ymax =1.09)+ annotation_custom(dip, xmin = 13.4, xmax = 14.4, ymin = 1.035, ymax =1.085)+
  coord_cartesian(clip = "off") + annotation_custom(beet, xmin = 15.5, xmax = 16.7, ymin = 0.86, ymax =1.255)+ annotation_custom(hem, xmin = 16.9, xmax = 17.65, ymin = 0.883, ymax =1.233)+
  coord_cartesian(clip = "off")+ coord_flip()
 

gg_table <- ggplot_gtable(ggplot_build(p))
gg_table$layout$clip[gg_table$layout$name=="panel"] <- "off"
grid.draw(gg_table)



#Bumblebee image credit to Melissa Broussard
```

