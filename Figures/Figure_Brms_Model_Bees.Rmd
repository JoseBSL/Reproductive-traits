---
title: ''
output:
  pdf_document: default
  html_document: default
---



```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=7, fig.width=13}


#LOAD LIBRARIES
library(ape) #for phylogenetic distance
library(dplyr) #data processing
library(rtrees) #for phylogenetic distance
library(DHARMa)
library(brms)
library(cmdstanr)
library(ggplot2)
library(patchwork)
library(tidybayes)
library(emmeans)

theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
     theme(text=element_text(color="black"),
           axis.title=element_text( size = rel(1.8)),
           axis.text=element_text(size = rel(1.2), color = "black"),
           legend.title=element_text(face="bold"),
           legend.text=element_text(size = rel(1.2)),
           legend.background=element_rect(fill="transparent"),
           legend.key.size = unit(1, 'lines'),
           panel.border=element_rect(color="black",size=1),
           panel.grid.minor.x =element_blank(),
           panel.grid.minor.y= element_blank(),
           panel.grid.major= element_blank()
     ))
}

#SAVE MODEL 1
setwd("~/Dropbox/PhD/R") #DROPBOX, files too large for github
model_bee_families <- readRDS("model_bee_families.RDS")
d_5_1 <- readRDS("data_model_just_bees.RDS")

##############

theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
     theme(text=element_text(color="black"),
           axis.title=element_text( size = rel(1.8)),
           axis.text=element_text(size = rel(1.2), color = "black"),
           legend.title=element_text(face="bold"),
           legend.text=element_text(size = rel(1.2)),
           legend.background=element_rect(fill="transparent"),
           legend.key.size = unit(1, 'lines'),
           panel.border=element_rect(color="black",size=1),
           panel.grid.minor.x =element_blank(),
           panel.grid.minor.y= element_blank(),
           panel.grid.major= element_blank()
     ))
}

#############
#PLOT MODEL 1 NON APIS
#############
ce_1 <- conditional_effects(model_bee_families, effects = "Clusters:bee_family",points=T) 
#change colnames in model output to use same aesthetics
#if not gg seems to don't like it
colnames(ce_1[[1]])[4] <- "a"
colnames(ce_1[[1]])[10] <- "Interaction"
ce_1[[1]][10]<- ce_1[[1]][10]+1

ggplot(ce_1[[1]], aes(x = Clusters, y = Interaction, colour = as.factor(bee_family), group = 
                        as.factor(bee_family))) +
  geom_point(size = 2.4, position = position_dodge(width = 0.8), alpha=1) +
  theme_ms()+ ylab("NÂº of visits per plant taxa") + xlab("Plant reproductive groups")+
  geom_point(data = d_5_1,aes(x = Clusters, y = (Interaction+1)),size = 1.2,shape=21, position = position_jitterdodge(dodge.width = 0.8, jitter.width = 0.2), alpha=0.3)+
  geom_errorbar(data=ce_1[[1]],mapping=aes(x=Clusters, ymin=lower__, ymax=upper__,colour = as.factor(bee_family), group = 
                                             as.factor(bee_family)), width=.6,alpha=0.8, size = 0.9,position = position_dodge(width = 0.8)) +ylim(0,200)+
  scale_color_manual("Bee families",values=c("#E69F00","#D55E00", "#287DAB", "#009E73", "#A7473A",  "black"))


```