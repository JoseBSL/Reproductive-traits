---
title: ''
output:
  pdf_document: default
  html_document: default
---



```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=7, fig.width=13}


#LOAD LIBRARIES
library(ape) #for phylogenetic distance
library(dplyr) #data processing
library(rtrees) #for phylogenetic distance
library(DHARMa)
library(brms)
library(cmdstanr)
library(ggplot2)
library(patchwork)
library(tidybayes)
library(emmeans)

theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
     theme(text=element_text(color="black"),
           axis.title=element_text( size = rel(1.8)),
           axis.text=element_text(size = rel(1.2), color = "black"),
           legend.title=element_text(face="bold"),
           legend.text=element_text(size = rel(1.2)),
           legend.background=element_rect(fill="transparent"),
           legend.key.size = unit(1, 'lines'),
           panel.border=element_rect(color="black",size=1),
           panel.grid.minor.x =element_blank(),
           panel.grid.minor.y= element_blank(),
           panel.grid.major= element_blank()
     ))
}

setwd("~/Dropbox/PhD/R") #DROPBOX, files too large for github

model_forest_data <- readRDS("model_forest_data.RDS")

dat <- readRDS("data_model.RDS")


#cond effect model visitation data
ce_1 <- conditional_effects(model_forest_data, effects = "Clusters:guild",points=T) 
#change colnames in model output to use same aesthetics
#if not gg seems to don't like it
colnames(ce_1[[1]])[4] <- "a"
colnames(ce_1[[1]])[10] <- "Interaction"
ce_1[[1]][10]<- ce_1[[1]][10]+1
ce_1[[1]][12]<- ce_1[[1]][12]+1
ce_1[[1]][13]<- ce_1[[1]][13]+1

#Order levels
ce_1[[1]]$guild <- as.character(ce_1[[1]]$guild)
ce_1[[1]]$guild <- factor(ce_1[[1]]$guild, levels = c("Bees","Non-bee-Hymenoptera","Syrphids","Non-syrphids-diptera","Lepidoptera","Coleoptera"))
dat$guild <- as.character(dat$guild)
dat$guild <- factor(dat$guild, levels = c("Bees","Non-bee-Hymenoptera","Syrphids","Non-syrphids-diptera","Lepidoptera","Coleoptera"))

#plot model
 ggplot(ce_1[[1]], aes(x = Clusters, y = Interaction, colour = as.factor(guild), group = 
  as.factor(guild))) +
  geom_point(size = 2.4, position = position_dodge(width = 0.68), alpha=1) +
  theme_ms()+ ylab("NÂº of visits per plant taxa") + xlab("Plant functional groups")+
  geom_point(data = dat,aes(x = Clusters, y = (Interaction),group = 
  as.factor(guild)),size = 1.2,shape=21, position = position_jitterdodge(dodge.width = 0.68, jitter.width = 0.25), alpha=0.14)+
  geom_errorbar(data=ce_1[[1]],mapping=aes(x=Clusters, ymin=lower__, ymax=upper__,colour = as.factor(guild), group = 
  as.factor(guild)), width=0.6,alpha=1, size = 1,position = position_dodge(width = 0.68)) +ylim(0,quantile(dat$Interaction, 0.95))+
  scale_color_manual("Floral visitors guilds",values=c("#E69F00","#D55E00", "#287DAB", "#009E73", "#A7473A",  "black","grey")) + ggtitle("A")


```