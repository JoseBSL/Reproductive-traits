---
title: ''
output:
  pdf_document: default
  html_document: default
---



```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=7, fig.width=22}

library(dplyr) #data processing
library(brms)
library(cmdstanr)
library(ggplot2)
library(cowplot)

# Theme for publication
theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
     theme(text=element_text(color="black"),
           axis.title=element_text( size = rel(1.3)),
           axis.text=element_text(size = rel(2), color = "black"),
           legend.title=element_text(face="bold"),
           legend.text=element_text(),
           legend.background=element_rect(fill="transparent"),
           legend.key.size = unit(0.9, 'lines'),
           panel.border=element_rect(color="black",size=1),
           panel.grid.minor.x =element_blank(),
           panel.grid.minor.y= element_blank(),
           panel.grid.major= element_blank()
     ))
}

#Set working directory
setwd("~/Dropbox/PhD/R") #DROPBOX, just need to run the analysis script to produce it but takes too long to have it here
#Load data
model_forest_data <- readRDS("model_forest_data.RDS")
m_5_clust_zero_neg_hclust_bees <- readRDS("m_5_clust_zero_neg_hclust_bees.RDS")

#Set working directory
setwd("~/R_Projects/Reproductive Traits")
#Load data
d_5_1 <- readRDS("Data/Csv/data_model.RDS")


ce_1 <- conditional_effects(model_forest_data, effects = "Clusters:guild",points=T) 
#change colnames in model output to use same aesthetics
#if not gg seems to don't like it
colnames(ce_1[[1]])[4] <- "a"
colnames(ce_1[[1]])[10] <- "Interaction"
ce_1[[1]][10]<- ce_1[[1]][10]+1
ce_1[[1]][12]<- ce_1[[1]][12]+1
ce_1[[1]][13]<- ce_1[[1]][13]+1

ce_1[[1]]$guild <- as.character(ce_1[[1]]$guild)

ce_1[[1]]$guild[ce_1[[1]]$guild=="Bee"] <- "Bees"
#Order levels
ce_1[[1]]$guild <- factor(ce_1[[1]]$guild, levels = c("Bees","Non-bee-Hymenoptera","Syrphids","Non-syrphids-diptera","Lepidoptera","Coleoptera","Other_insects"))
d_5_1$guild <- factor(d_5_1$guild, levels = c("Bees","Non-bee-Hymenoptera","Syrphids","Non-syrphids-diptera","Lepidoptera","Coleoptera","Other_insects"))
#plot model
p1 <- ggplot(ce_1[[1]], aes(x = Clusters, y = Interaction, colour = as.factor(guild), group = 
  as.factor(guild))) + geom_point(size = 1.5, position = position_dodge(width = 0.75), alpha=1) +
  theme_ms() + ylab("Nº of visits per plant taxa") + xlab("Plant functional groups") +
  geom_errorbar(data=ce_1[[1]],mapping=aes(x=Clusters, ymin=lower__, ymax=upper__,colour = as.factor(guild), group = 
  as.factor(guild)), width=.8,alpha=0.8, size = 1.4,position = position_dodge(width = 0.75)) +
  scale_color_manual("Floral visitors\nfunctional groups",values=c("#E69F00","#D55E00", "#287DAB", "#009E73", "#A7473A",  "black","grey")) + ylim(0,30)

setwd("~/Dropbox/PhD/R") #DROPBOX, just need to run the analysis script to produce it but takes too long to have it here

d_5_1 <- readRDS("data_model_just_bees.RDS")

ce_1 <- conditional_effects(m_5_clust_zero_neg_hclust_bees, effects = "Clusters:bee_family",points=T) 
#change colnames in model output to use same aesthetics
#if not gg seems to don't like it
colnames(ce_1[[1]])[4] <- "a"
colnames(ce_1[[1]])[10] <- "Interaction"
ce_1[[1]][10]<- ce_1[[1]][10]+1


p2 <- ggplot(ce_1[[1]], aes(x = Clusters, y = Interaction, colour = as.factor(bee_family), group = 
  as.factor(bee_family))) + geom_point(size = 1.5, position = position_dodge(width = 0.75), alpha=1) +
  theme_ms() + ylab("Nº of visits per plant taxa") + xlab("Plant functional groups") +
  geom_errorbar(data=ce_1[[1]],mapping=aes(x=Clusters, ymin=lower__, ymax=upper__,colour = as.factor(bee_family), group = 
  as.factor(bee_family)), width=.8,alpha=0.8, size = 1.4,position = position_dodge(width = 0.75)) +
  scale_color_manual("Bees\nfunctional groups",values=c("#E69F00","#D55E00", "#287DAB", "#009E73", "#A7473A",  "black")) + ylim(0,75)


########################################################################################################################################################

plot_grid(p1,p2, align = "hv")

```