---
title: \singlespacing \vspace{-1.6cm} \LARGE Covariation among reproductive traits in flowering plants shape their interactions with pollinators

#author: 
#  - Jose B. Lanuza^1,2^*
#  - Romina Rader^1^
#  - Jamie Stavert^3^
#  - Liam K. Kendall^4^
#  - Manu E. Saunders^1^
#  - Ignasi Bartomeus^2^

# may use lua filters for affiliations etc: see https://stackoverflow.com/a/52919256

# date: '`r Sys.Date()`'

output:
  bookdown::pdf_document2:
    fig_caption: yes
    fig_width: 7
    fig_height: 7
    df_print: kable
    keep_tex: yes
    number_sections: no
    extra_dependencies: ["float"]
    toc: no
    fig_crop: no
    includes:
      in_header: header.tex
    
documentclass: article
# classoption: twocolumn, landscape, etc
papersize: a4
pagestyle: plain  # plain, empty, headings
geometry: margin=1in
linestretch: 2
fontfamily: mathpazo
fontsize: 12pt

bibliography: 
  - references.bib
  - knitcitations.bib
# zotero: "My shared Zotero group"
csl: proceedingsb.csl #ecology letters
notes-after-punctuation: false
link-citations: yes
linkcolor: RoyalBlue
urlcolor: RoyalBlue
links-as-notes: false
subparagraph: yes

header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
- \usepackage{float}
- \floatplacement{figure}{H}
- \usepackage[skip=3pt]{caption}
- \captionsetup[figure]{labelformat=empty}
- \usepackage{setspace}
- \usepackage{titlesec}
- \titlespacing{\title}{0pt}{\parskip}{-\parskip}
- \usepackage[style=nature]{biblatex}
- \usepackage[labelformat = empty]{caption}
- \usepackage{pdflscape}
- \usepackage[T1]{fontenc}
- \DeclareUnicodeCharacter{0301}{*************************************}
- \DeclareUnicodeCharacter{1EF3}{*************************************}
- \usepackage{orcidlink}
---


```{=tex}
\doublespacing
\normalsize
```

# Abstract

1. Globally, plants display enormous variation in life history strategies and trait combinations. However, evidence suggests that evolutionary and physiological constraints limit the number of plant ecological strategies. Although there have been recent advances in understanding correlations among plant traits, reproductive traits are rarely considered, despite their key role in shaping plant life-history strategies and interactions with pollinators. 

2. Here, using a global dataset of 18 reproductive traits for 1,506 species, we investigate the reproductive spectrum of flowering plants to identify how it shapes interactions with pollinators. 

3. We show that over 50% of all trait variation is explained by the first two reproductive axes, which represent the negative correlation between flower number and flower size, and the negative correlation between autonomous selfing and floral display size. In addition, these reproductive axes were associated with different numbers of interacting partners and visitation rates of the distinct pollinator guilds. However, reproductive axes explain a relatively small amount of variance in pollinator interactions highlighting the need to incorporate other factors along with reproductive traits to fully explain large scale patterns of plant-pollinator interactions. 

4. Our study identifies the major reproductive trait correlations in flowering plants and their role in shaping plant-pollinator interactions at a macro-ecological scale. These findings emphasize the importance of considering reproductive traits in the global spectrum of plant form and function, and the need to explore beyond floral morphological traits to broaden our understanding of plant-pollinator interactions.

\textbf{Keywords:} life-history strategies \| plant reproductive traits \| plant-pollinator interactions

```{=tex}
\doublespacing
\vspace{5mm}
\normalsize
```
```{r setup, include=FALSE, cache=FALSE, message = FALSE}

library("knitr")

### Chunk options: see http://yihui.name/knitr/options/ ###
## Text results
opts_chunk$set(echo = FALSE, warning = TRUE, message = TRUE)

## Code decoration
opts_chunk$set(tidy = TRUE, comment = NA, highlight = TRUE)

## Cache
# opts_chunk$set(cache = 2, cache.path = "output/cache/")

## Plots
opts_chunk$set(fig.path = "output/figures/")

```

```{r knitcitations, cache = FALSE}
library(knitcitations)
cleanbib()   
cite_options(citation_format = "pandoc")

```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
```

# 1. Introduction

Flowering plants display an astonishing diversity of reproductive structures [@barrett2002; @schiestl2013] that shape their interactions with animal pollinators [@fenster2004; @dellinger2020]. The variety of reproductive strategies used by different plant species, from specialised reliance on a single pollinator, to full self-pollination, is incredibly rich. However, not all reproductive trait combinations in plants are possible due to evolutionary and ecological constraints [@stearns1989; @agrawal2020]. Despite recent advances in theoretical and empirical understanding of correlations between plant reproductive traits at large ecological scales [@salguero2016; @friedman2020; @paterno2020; @roddy2021; @song2022], studies typically focus on just a few traits, often in isolation. Thus, to develop a comprehensive understanding of the plant reproductive spectrum of trait variation, as done recently for root [@laughlin2021], leaf [@wright2004] and wood [@chave2009] related traits, we require a multi-trait perspective with broad geographical coverage. Importantly, characterization of the plant reproductive spectrum could reveal key reproductive strategies among different species [@agrawal2020] and improve knowledge of associations between specific reproductive traits and pollinators [@roddy2021].

With the recent availability of large trait databases [e.g., TRY @kattge2011;  COMPADRE @salguero2015], there has been increased research on plant ecological strategies, which has produced identification of global patterns in plant form and function [@salguero2016; @diaz2016; @bruelheide2018; @carmona2021]. However, studies that look at multiple traits tend to overlook plant reproductive traits [@evojtko2020; @ruger2018; @roddy2021], and focus on trait correlations in other plant organs such as morphological and physiological leaf traits [@wright2004; @shipley2006; @donovan2011; @osnas2013]. Despite the lack of a holistic understanding that depicts reproductive trait covariation patterns, there are widely recognized associations between plant reproductive trait pairs such as the negative correlation between flower size and flower number [@sargent2007; @kettle2011; @vojtko2022]; the positive association between flower size and outcrossing rate [@goodwillie2010]; or the positive correlation between outcrossing rate and lifespan [@barrett2003; @munoz2016; @moeller2017]. Although identification of these trait correlations has allowed progress toward a conceptual framework that integrates different floral trait relationships [@roddy2021], we still lack empirical understanding of how these associations among floral and other reproductive traits (e.g., reproductive biology) shape plant life history strategies.

Trait-based approaches [@fenster2004; @rosas2014] and trait-matching analyses [@stang2009; @bartomeus2016] are powerful for exploring the underlying mechanisms driving plant-pollinator interactions. For example, plant traits can define species' network roles [e.g., specialists vs generalists @tur2013] and plant species that occupy reproductive trait space extremes are likely to be more specialised and display tighter trait-matching with pollinators [@junker2013; @coux2016]. Indeed, the degree of morphological matching between plants and pollinators often determines whether or not interactions occur, and consequently influences  the broader network structure [@stang2009; @ibanez2012]. However, it is still unclear how specific reproductive traits (e.g., mating or compatibility system) influence plant-pollinator associations [@sargent2008; @tur2013; @devaux2014]. For example, species with high selfing rates may evolve to invest less in floral rewards resulting in a lower number of pollinator visits [@devaux2014]. Indeed, both morphology and mating system can determine a species' functional role within pollination networks, and the combination of several traits increases power for predicting network structure [@eklof2013]. Because the species position within the multidimensional trait space can result in different interaction patterns or adaptations to pollinators [see @dehling2016 for a purely morphological approach], the use of the reproductive trait space to explore plant-pollinator interactions could help to identify species functional roles and associations of traits with specific pollinators (i.e., pollination syndromes).

Here, we explore the spectrum of reproductive traits in flowering plants, within a global set of plant-pollinator networks, to identify reproductive trait covariation and how this influences the network of interactions between plants and pollinators. First, we identify the major axes of reproductive trait variation and correlations among traits for plant species. Then, we investigate the associations between plant species’ positions in reproductive trait space and the strength of their interactions with different pollinator guilds within networks. Finally, we determine how the main axes of reproductive trait variation influence plant species' functional roles within pollination networks, using a range of complementary interaction network metrics.




# 2. Methods

## (a) Plant-pollinator network studies

We selected 28 studies from 18 different countries that constituted a total of 64 plant-pollinator networks (see table S1 and figure S1). These studies recorded plant-pollinator interactions in natural systems and were selected so that we had broad geographical representation across different ecological communities. The pollinators documented by these studies are primarily insect pollinators (97.8% of the total visits recorded) and the plants are characterised by a clear dominance of smaller life forms (i.e., 61% of herbs, 28% of shrubs and 11% of trees). Although these studies differ in sampling effort and methodology, all studies provided information about plant-pollinator interactions (weighted and non-weighted), which we used to build a database of plant species that are likely to benefit, to some degree, from animal pollination. Many of these networks are freely available either as published studies [e.g., @carvalheiro2014; @olesen2007; @fortuna2010] or in online archives [e.g., Mangal @poisot2016;  The Web of Life @fortuna2010]. In total, our network dataset constituted 60 weighted (number of visits) and four unweighted (interaction presence-absence) networks, each sampled at a unique location and year, as well as eight meta-networks where interactions were pooled across several locations and multiple years.

## (b) Taxonomy of plants and pollinators

All species names, genera, families and orders were retrieved and standardised from the taxonomy data sources NCBI (<https://www.ncbi.nlm.nih.gov/taxonomy>) for plants and ITIS (<https://www.itis.gov/>) for pollinators, using the R package *taxize* [@chamberlain2020]. We filled the 'not found' searches manually using <http://www.theplantlist.org/> and <http://www.mobot.org/> for plants and <http://www.catalogueoflife.org/> for pollinators.

## (c) Plant traits

We selected a total of 18 quantitative and categorical functional traits that included reproductive traits and traits related with plant form and size (see table 1). Reproductive traits consisted of those related to floral and reproductive biology: (i) floral traits included those related to the size of floral organs (e.g., style length), floral display size (e.g., flower number) and floral rewards (e.g., pollen quantity), while (ii) reproductive biology traits represented the plant reproductive system (i.e., the breeding, mating and compatibility system). The remaining traits were related to plant size and form (i.e., plant height, lifespan and life form), which are commonly used to characterise the fast-slow continuum of plant trait variation [@salguero2016]. For each plant species, we undertook an extensive literature and online search for all traits across a wide range of resources (plant databases, online floras, books, journals and images). From a matrix comprising a total of 27,108 possible cells (considering all traits and plant species: 18 columns × 1,506 species), we were able to fill 22,796 cells (84.1% of the dataset, see figure S2 for missing value information for each trait). An extended description of each trait and how it was obtained can be found in Appendix S1.



\singlespacing

```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE, fig.height=1, fig.width=14}

library(kableExtra)

library(dplyr)
library(readxl) #read excel file (trait data)
library(dplyr) #data manipulation
library(visdat) #VISUALIZE MISSING DATA
library(naniar)
library(tidyverse)
########################################################################################################################################################
#1) READ TRAIT DATA
########################################################################################################################################################
#load data
trait_data <- read_excel("../Data/Trait_data_raw/Trait_data_final.xlsx",na = "NA")
########################################################################################################################################################
#2) A) CLEAN DATA AND B) RENAME LEVELS FOR IMPUTATION 
########################################################################################################################################################
#####
#A) CLEAN DATA
#####
#select just filled rows
trait_data_1 <- trait_data[1:1712,] #It may be a more elegant way but this does the job, 1712 rows of data

#filter data, select species with flower level info and capitulum
trait_filtered <- filter(trait_data_1, Info_level == "flower" |  Info_level == "capitulum")
#remove NA's and duplicated species|Some spp are repeated once the spp names are standardize with taxize
trait_filtered$Species_all[trait_filtered$Species_all=="NA"]<-NA 
trait_filtered_1 <- trait_filtered[!is.na(trait_filtered$Species_all),]
trait_filtered_2 <- trait_filtered_1[!duplicated(trait_filtered_1$Species_all),]

#Select columns to work with
t <- trait_filtered_2[c("Species_geonet","Order_all","Family_all","Genus_all","Species_all","Breeding_system","Compatibility_system",
                        "Autonomous_selfing_level","Autonomous_selfing_level_fruit_set", "Flower_morphology", "Flower_symmetry", 
                        "Flowers_per_plant","Floral_unit_width", "Corolla_diameter_mean", "Corolla_length_mean","Style_length", "Ovule_number", 
                        "life_form", "lifespan","Plant_height_mean_m","Nectar_presence_absence","Nectar_ul","Nectar_mg","Nectar_concentration","Pollen_per_flower")]

########################################################################################################################################################
#####
#B) RENAME LEVELS FOR IMPUTATION
#####
#Breeding_system| For the purpose of this study we are not going to consider other complex breeding systems and just focus on 
#Hermaphroditism, dioecy and monoecy, the closest levels are grouped within each category
t$Breeding_system <- as.character(t$Breeding_system)
t$Breeding_system[t$Breeding_system=="androdioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="androgynodioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="andromonoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="gynodioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="gynoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="gynomonoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="gynomonoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="monoecious_dioecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="polygamo-dioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="protandrous"] <- "hermaphrodite"
t$Breeding_system[t$Breeding_system=="protogynous"] <- "hermaphrodite"
t$Breeding_system[t$Breeding_system=="subdioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="submonoecious"] <- "monoecious"
#Change to capital letters| There are already levels with lower case
t$Breeding_system[t$Breeding_system=="monoecious"] <- "Monoecious"
t$Breeding_system[t$Breeding_system=="dioecious"] <- "Dioecious"
t$Breeding_system[t$Breeding_system=="hermaphrodite"] <- "Hermaphrodite"
t$Breeding_system <- as.factor(t$Breeding_system)

#Now 3 levels
#Flower_morphology
t$Flower_morphology <- as.character(t$Flower_morphology)
t$Flower_morphology[t$Flower_morphology=="bowl"] <- "open"
t$Flower_morphology[t$Flower_morphology=="dish"] <- "open"
t$Flower_morphology[t$Flower_morphology=="exposed"] <- "open"
t$Flower_morphology[t$Flower_morphology=="spadix"] <- "spike"
t$Flower_morphology[t$Flower_morphology=="open"] <- "Open"
t$Flower_morphology[t$Flower_morphology=="brush"] <- "Brush"
t$Flower_morphology[t$Flower_morphology=="campanulate"] <- "Campanulate"
t$Flower_morphology[t$Flower_morphology=="capitulum"] <- "Capitulum"
t$Flower_morphology[t$Flower_morphology=="funnelform"] <- "Funnelform"
t$Flower_morphology[t$Flower_morphology=="papilionaceous"] <- "Papilionaceous"
t$Flower_morphology[t$Flower_morphology=="spike"] <- "Spike"
t$Flower_morphology[t$Flower_morphology=="tube"] <- "Tube"
t$Flower_morphology <- as.factor(t$Flower_morphology)

#Life span
t$lifespan <- as.character(t$lifespan )
t$lifespan[t$lifespan=="annual"] <- "short_lived"
t$lifespan[t$lifespan=="biennial"] <- "short_lived"
t$lifespan[t$lifespan=="short_lived"] <- "Short lived"
t$lifespan[t$lifespan=="perennial"] <- "Perennial"
t$lifespan <- as.factor(t$lifespan )

########################################################################################################################################################
#3) EXPLORE PATTERNS OF MISSING DATA
########################################################################################################################################################

#We convert cualitative data to quantitative to reduce missing data on this column and hence conduct the imputation 
#use ifelse base r does not work with these NA'S Even with work around. base r does not like the na option of read excel
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("high") & is.na(t$Autonomous_selfing_level_fruit_set), 88, t$Autonomous_selfing_level_fruit_set)
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("medium") & is.na(t$Autonomous_selfing_level_fruit_set), 50.5, t$Autonomous_selfing_level_fruit_set)
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("low") & is.na(t$Autonomous_selfing_level_fruit_set), 13, t$Autonomous_selfing_level_fruit_set)
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("none") & is.na(t$Autonomous_selfing_level_fruit_set), 0, t$Autonomous_selfing_level_fruit_set)

#t$Nectar_ul adding it here just to see how many cells 
#Now we just select presence/absence of nectar
#select columns of interest
t <- t[c("Species_geonet","Order_all","Family_all","Genus_all","Species_all","Breeding_system","Compatibility_system","Autonomous_selfing_level",
         "Autonomous_selfing_level_fruit_set", "Flower_morphology", "Flower_symmetry", "Flowers_per_plant", "Floral_unit_width",
         "Corolla_diameter_mean", "Corolla_length_mean", "Style_length", "Ovule_number", "life_form", "lifespan",
         "Plant_height_mean_m","Nectar_presence_absence","Nectar_ul","Nectar_mg","Nectar_concentration","Pollen_per_flower")]

########################################################################################################################################################
#4) CALCULATE PHYLOGENETIC DISTANCE TO CORRECT WITH EIGENVALUES IN THE IMPUTATION
########################################################################################################################################################
#Convert to factor 
cols <- c("Order_all", "Family_all", "Genus_all", "Species_all", "Compatibility_system", "Autonomous_selfing_level", "Flower_morphology",
          "Flower_symmetry", "life_form", "lifespan","Nectar_presence_absence")
t[cols] <- lapply(t[cols], factor)  ## as.factor() could also be used

cols.num <- c("Family_all","Genus_all","Species_all")
t[cols.num] <- sapply(t[cols.num],as.character)
t$Species_all <- gsub("Species_all_", "", t$Species_all)

t <- t[!t$Species_all == "Pinus luchuensis", ]   # remove gymnosperm species

#remove species that are not until species level
#ALL THE SPECIES WITH SP. ARE DELETD
t$Species_geonet <- gsub("M_PL_.*","",t$Species_geonet) #subsitute partial string for nothing
t$Species_geonet <- gsub(" $","", t$Species_geonet, perl=T) #remove trailing spaces
t$Species_geonet <-  sub('sp.1$', 'sp.', t$Species_geonet)#PREPARE ALL SP TO SP.
t$Species_geonet <- sub('sp.2$', 'sp.', t$Species_geonet)#PREPARE ALL SP TO SP.
t$Species_geonet <- sub('sp$', 'sp.', t$Species_geonet) #PREPARE ALL SP TO SP.
t$Species_geonet <- sub("sp.$", "DELETE", t$Species_geonet) #change all sp. for DELETE
t <- t[- grep("DELETE",  t$Species_geonet),] #remove species with "DELETE"
#CHECK LEVELS

#Make these NA's as NA
t$Species_all[t$Species_all=="NA"] <- NA
t$Family_all[t$Family_all=="NA"] <- NA
t$Genus_all[t$Genus_all=="NA"] <- NA
#remove NA's
t <- t[!is.na(t$Family_all),]
t <- t[!is.na(t$Species_all),]
t <- t[!is.na(t$Genus_all),]



missing.values <- t %>%
  gather(key = "key", value = "val") %>%
  mutate(isna = is.na(val)) %>%
  group_by(key) %>%
  mutate(total = n()) %>%
  group_by(key, total, isna) %>%
  summarise(num.isna = n()) %>%
  mutate(pct = num.isna / total * 100)

n_of_records <- subset(missing.values, isna=="FALSE")

Trait <- c("Plant height", "Flower width", "Flower length", "Inflorescence width", "Style length", "Ovules per flower",
           "Flowers per plant", "Microliters of nectar", "Milligrams of nectar", "Pollen grains per flower", "Autonomous selfing (fruit set)")

Trait1 <- linebreak(c("Lifepan", "Life form", "Flower shape", "Flower symmetry", "Nectar", "Compatibility system", "Breeding system"),align = c("l"))

#T.cat <- linebreak(c("Short-lived \n Perennial", "Herb \n Shrub #\n Tree", "Brush \n Campanulate \n Capitulum \n Open \n #Papilionaceous \n Tube",  "Actinomorphic \n Zygomorphic",
#           "Presence \n Absence", "Self-incomp. \n Part. #self-comp. \n Self-comp.", "Hermaphrodite \n Monoecious \n #Dioecious"),align = c("l"))
#
T.cat <- linebreak(c("Short-lived and perennial", "Herb, shrub and tree", "Brush, campanulate, capitulum,\n open, papilionaceous and tube",  "Actinomorphic and zygomorphic",
           "Presence and absence", "Self-incompatible, partially self-compabtile \n and self-compatible", "Hermaphrodite, monoecious and dioecious"), align = c("l"))



Number_of_records_quantitative <- c(n_of_records$num.isna[n_of_records$key=="Plant_height_mean_m"], n_of_records$num.isna[n_of_records$key=="Corolla_diameter_mean"],
  n_of_records$num.isna[n_of_records$key=="Corolla_length_mean"], n_of_records$num.isna[n_of_records$key=="Floral_unit_width"],
  n_of_records$num.isna[n_of_records$key=="Style_length"], n_of_records$num.isna[n_of_records$key=="Ovule_number"],
  n_of_records$num.isna[n_of_records$key=="Flowers_per_plant"], n_of_records$num.isna[n_of_records$key=="Nectar_ul"],
  n_of_records$num.isna[n_of_records$key=="Nectar_mg"], n_of_records$num.isna[n_of_records$key=="Nectar_concentration"], n_of_records$num.isna[n_of_records$key=="Pollen_per_flower"],
  n_of_records$num.isna[n_of_records$key=="Autonomous_selfing_level_fruit_set"]) 

Number_of_records_categorical <- c(n_of_records$num.isna[n_of_records$key=="lifespan"], n_of_records$num.isna[n_of_records$key=="life_form"],
                                   n_of_records$num.isna[n_of_records$key=="Flower_morphology"], n_of_records$num.isna[n_of_records$key=="Flower_symmetry"],
                                   n_of_records$num.isna[n_of_records$key=="Nectar_presence_absence"], n_of_records$num.isna[n_of_records$key=="Autonomous_selfing_level"],
                                   n_of_records$num.isna[n_of_records$key=="Compatibility_system"], n_of_records$num.isna[n_of_records$key=="Breeding_system"],
                                   rep("",4))

T.range <- c("0.01-30m", "0.50-205mm", "0.20-195mm", "0.80-300mm", "0-138mm", "1-25000", "1-1.8 x $10^5$", "0-160$\\mu$l", "0-6.1mg", "13-2 x $10^8$", "0-100$\\%$")
  
dat_1 <- data.frame(Trait,T.range)
dat_2 <- data.frame(Trait1, T.cat)

colnames(dat_1) <- c("Quantitative traits", "Numerical range")
colnames(dat_2) <- c("Categorical traits", "Categories")

#kable(list(dat_1, dat_2), booktabs = T, linesep = #"\\addlinespace", escape = FALSE,caption = "\\textbf{Table 1 | #Quantitative and categorical traits used in this study.}") %>%
#  kable_styling(full_width = F,font_size = 10) %>%  #column_spec(1:4, 
#              width = "3in", 
#              latex_valign = "m")
#
#

colnames(dat_1) <- c("Traits", "Numerical range/Categories")
colnames(dat_2) <- c("Traits", "Numerical range/Categories")

d <- rbind(dat_1,dat_2)

kable(d, booktabs = T, linesep = "\\addlinespace", escape = FALSE,caption = "\\textbf{Table 1.} Quantitative and categorical traits used in this study.") %>%
  kable_styling(full_width = F,font_size = 12) %>% row_spec(0, bold=T) %>% pack_rows("Quantitative", 1, 11) %>%
pack_rows("Categorical", 12, 18) 



```

\doublespacing

## (d) Phylogenetic Distance

We calculated the phylogenetic distance between all plant species considered using the function *get_tree* from the package *rtrees* (<https://github.com/daijiang/rtrees>), which downloads phylogenetic distances from the extended R implementation of the Open Tree of Life [@smith2018; @jin2019].

## (e) Data Imputation

To avoid excluding species with trait missing values, we imputed trait missing values with the help of the function *missForest* [@stekhoven2012] which allows imputation of datasets with continuous and categorical variables. We accounted for the phylogenetic distance among species on the imputation process by including the eigenvectors from principal component analysis of the phylogenetic distance (PCoA), which has been shown to improve the performance of *missForest* [@penone2014]. To extract the eigenvectors, we used the function *PVRdecomp* from the package *PVR* [@santos2018] based on a previous conceptual framework that considers phylogenetic eigenvectors [@diniz-filho2012]. We conducted two different imputations, one for the full set of species (1,506 species: 5.79% of missing values), and excluding nectar and pollen traits because of the high percentage of missing values (figure S2), and a second one for the subset of species with data for pollen per flower and microliters of nectar (755 species: 8.01% of missing values). To corroborate that our imputation of missing values did not affect our results, we evaluated the reproductive spectrum (see section below) with and without imputed values and results for the two datasets were consistent (Fig S3 and Fig S4).

## (f) Plant strategies analysis

We explored the association between the different quantitative plant traits using a phylogenetically informed Principal Component Analysis (pPCA). We did not include the quantitative variables of flower length and inflorescence width because they were highly and moderately correlated to flower width, respectively (Pearson's correlation = 0.72, *P* \< 0.01 and Pearson's correlation = 0.36, *P* \< 0.01), and thus we avoided overemphasise flower size on the spectrum of trait variation. Prior to the analyses, we excluded outliers and standardised the data. Specifically, due to the high sensitivity of dimensionality reduction to outliers [@serneels2008; @legendre2012], we excluded values outside the 2.5th--97.5th percentile range, and thus our final dataset had 1,236 species. Then, we log transformed all continuous variables to reduce the influence of extreme values and then z-transformed (X= 0, SD=1) these variables so that they were within the same numerical range, as recommended for principal component analysis [@legendre2012]. Although qualitative traits were not included in the dimensionality reduction analysis, we also investigated their position in the trait space and the statistical association of the different qualitative traits with the main axes of trait variation using an ANOVA and Tukey test. We performed the pPCA using the function *phyl.pca* from the package *phytools* [@revell2012] with the method lambda ($\lambda$) that calculates the phylogenetic correlation between 0 (phylogenetic independence) and 1 (shared evolutionary history) and we implemented the mode “covariance” because values for each variables were on the same scale following transformation [@abdi2010]. Finally, we conducted an additional phylogenetic informed principal component analysis for the subset of species with pollen and nectar quantity data. For this, we included all quantitative traits included in the main pPCA, plus pollen grains and microlitres of nectar per flower.

## (g) Phylogenetic signal

We calculated the phylogenetic signal of the different quantitative traits on the imputed dataset with the full set of species (N = 1,506) with the package *phytools* [@revell2012] and used Pagel's $\lambda$ as a measurement of the phylogenetic signal. However, for pollen and nectar traits, phylogenetic signal was calculated only on the subset of species that had quantitative information for these traits (N = 755).

## (h) Network analyses

### (i) Visitation patterns

We used Bayesian modelling (see details below) to investigate how the different guilds of pollinators interacted along the main axes of reproductive trait variation using qualitative and quantitative measures of plant-pollinator interactions. Specifically, interactions between plants and pollinators in binary networks were defined as the presence or absence of floral visitation, while in weighted networks, interactions were measured as the the number of visits from each insect species to different plant species. Although floral visitors are not always pollinators and the number of visits does not consider the pollination efficiency of each species [@ballantyne2015], the number of visits does provide valuable information about the relative contributions different floral visitors make to pollination [@vazquez2005; @vazquez2012]. Therefore, despite the fact that we do not evaluate pollinator effectiveness we refer to the different floral visitors as pollinators.



We divided pollinators into six main taxonomical guilds that differ in life form, behaviour and thus likely play different ecological roles: (i) bees (Hymenoptera-Anthophila), (ii) non-bee-Hymenoptera (Hymenoptera-non-Anthophila), (iii) syrphids (Diptera-Syrphidae), (iv) non-syrphid-Diptera (Diptera-non-Syrphidae), (v) Lepidoptera, and (vi) Coleoptera. Note that we excluded non-insect pollinators from our analyses as they comprised only a 2.2% of the total visits recorded in our set of studies. Moreover, because bees had the greatest number of occurrences in networks  (2,256 records) and the highest frequency of visits, we further broke this group down into the main bee families (Andrenidae, Apidae, Colletidae, Halictidae, and Megachilidae). In addition, we found that *Apis mellifera* was the pollinator with the largest proportion of occurrences in networks (7.55% of the total). This is consistent with previous research showing that *A. mellifera* was the most frequent pollinator in a similar dataset of 80 plant-pollinator networks in natural ecosystems [@hung2018]. Hence, to control for the effect of *A. mellifera* on observed visitation patterns of bees, we conducted an analogous analysis with presence-absence of the interaction and number of visits excluding *A. mellifera*. We found that *A. mellifera*, was partly driving some of the observed trends on PC1 (figure S5). However, we did not detect major differences on PC2 and PC3.

We used Bayesian generalised linear mixed models in the R package *brms* [@burkner2017] to model the presence-absence of observed interactions and number of visits as a function of the main axes of plant trait variation (i.e., PC) and their interactions with pollinator guilds (i.e., PGs; e.g., number of visits \~ PC1 x PGs + PC2 x PGs + PC3 x PGs). Because we were interested in possible differences in visitation patterns among pollinator guilds to plants with different reproductive strategies, we included interactions between the main axes of trait variation (PC1, PC2 and PC3) and the different pollinator guilds in the model. We added a nested random effect of networks within the study system to capture the variation in networks among studies and within networks. Moreover, we included the phylogenetic covariance matrix as a random factor due to the possible shared evolutionary histories of species and therefore lack of independence among them. We specified for the presence or absence of an interaction and number of visits with Bernoulli and a zero inflated negative binomial distributions, respectively. The models were run with 3,000 iterations with previous 1,000 warm up iterations and with non or very weakly informative priors from the brm function so the priors had negligible influence on the results [@burkner2017]. We set delta ($\Delta$) to 0.99 to avoid divergent transitions and visualised the posterior predictive checks with the function *pp_check* using the *bayesplot* package [@gabry2019].

### (ii) Plant species network roles

We also used Bayesian modelling to investigate how the main axes of trait variation determined different plant species' functional roles within pollination networks. For this, we selected complementary species-level network metrics, commonly applied in bipartite network studies [@dormann2008], with clear ecological interpretations and are relevant for defining species' functional roles in networks. Specifically, the species-level metrics we included were: (i) sum of visits per plant species; (ii) normalised degree, calculated as the number of links per plant species divided by the total possible number of partners; and (iii) selectivity (d') [@bluthgen2006], which measures the deviation of an expected random choice of the available interaction partners and ranges between 0 (maximum generalisation) and 1 (maximum specialisation). Normalised degree and selectivity were calculated with the *specieslevel* function in the R package *bipartite* [@dormann2008]. We modelled each plant species metric (sum of visits, normalised degree and plant selectivity) as a function of the three main axes of trait variation (plant species level metric \~ PC1 + PC2 + PC3). For the different response variables in each model (i.e., each plant species level metric), we used different distribution families (zero inflated negative binomial for the sum of visits, weibull for normalised degree, and zero-one inflated beta for selectivity). Finally, we used the same random factors, model settings and conducted the same posterior predictive checks for each model as detailed above in the 'visitation patterns' section.

Our analyses were conducted on the subset of 60 weighted networks (out of a total of 64 networks) sampled in a unique flowering season and site, which included 556 plant and 1,126 pollinator species. In total, our network dataset (excluding meta- and non-weighted networks) included 2,256 interactions for bees, 1,768 for non-syrphid-dipterans, 845 for syrphids, 437 for lepidopterans, 432 for coleopterans, and 362 for non-bee-hymenopterans. Sampling methods varied across studies but this was accounted for in analyses by including study identity as a  random effect in our models. All analyses were conducted in R version *4.0.3*.

# 3. Results

## (a) Plant strategies analysis

Our phylogenetically informed principal component analysis captured  51.8% and 70.97% of the reproductive trait variation in the first two and three axes, respectively (figure 1 and figure S6). The first principal component (PC1; the flower number - flower size axis) represented 26.72% of the trait variation and indicated a negative correlation between flower number and flower size. The main contributing traits to PC1 were plant height, flower number, ovule number and flower size (loadings \> \|0.5\|; table S3) but style length also contributed moderately (loading = -0.33). One end of this axis comprised species with high investment in flower number and plant height but small flower size, short style length and low ovule number. For instance, *Cornus florida* occurred at this end of the spectrum, which, on average, has approximately 10,000 flowers, is 7.5 m high, has flowers that are 3 mm wide, styles 3.5 mm long and  two ovules per flower. The other end of this spectrum had species that were short in height, with few large flowers that had long styles and many ovules. For example, *Petunia axillaris* on average, is 0.5 m high and has approximately 10 flowers per plant that are over 50 mm wide with 25 mm long styles and over 200 ovules. The second principal component (PC2; the autonomous selfing - floral display axis) encompassed 25.05% of the trait variation and represented variation from low to high autonomous selfing (i.e., high to low pollinator dependence). The main driver of trait variation on PC2 was autonomous selfing (loading = 0.85) but all other traits (except ovule number) made moderate contributions (loadings ranging between 0.27 to 0.4; table S3). Generally speaking, species with low autonomous selfing had larger and many flowers with long styles, and were tall. *Zuccagnia punctata* occurred at this extreme of the spectrum, which is a self-incompatible species, completely dependent on animal pollination for seed production, producing  approximately 1,500 flowers per plant with an average height of 3 m and 20 mm long styles. In contrast, species with high autonomous selfing tended to have fewer and smaller flowers with shorter styles, and were shorter in height. *Veronica peregrina* occurred at this end of the spectrum, and is a self-compatible plant that requires little or no pollination by animals, it has approximately 20 flowers per plant, is 0.2 m high and has 0.25 mm long styles. The third principal component (PC3; the style length - autonomous selfing axis) explained a considerable amount of trait variability (19.17%) and represented a positive correlation between style length (loading = -0.66) and autonomous selfing (loading = \|-0.51\|), where species with short styles had low autonomous selfing and species with long styles high autonomous selfing. The remaining traits, apart from ovule number, were all positively correlated with style length and autonomous selfing (loadings from -0.23 to -0.46; table S3). In addition, the pPCA with the subset of species that we had nectar and pollen quantity data for showed that nectar quantity (microlitres of nectar per flower) and pollen grains per flower were positively associated with floral display size. Floral rewards were particularly strongly correlated with flower size but weakly correlated with flower number (figure S4). The first two principal components for this pPCA explained similar variance  (45.52%) and similar associations of traits, despite some variability in the loadings (table S4).

```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, out.width="85%", fig.height=10,fig.align='center',fig.width=10,fig.cap= "\\textbf{Figure 1.} Phylogenetically informed principal component analysis (pPCA) of 1,236 plant species from 28 plant-pollinator network studies. The solid arrows indicate the direction of the different quantitative traits (flower number, plant height, style length, flower size, ovule number and level of autonomous selfing) across the two main axes of trait variation. The length of the arrows indicate the weight of the variables on each principal component and the dashed lines show the opposed direction of trait variation. The icons at both ends of arrows and dashed lines illustrate the extreme form of the trait continuum."}

#Load libraries
library(viridis) #COLOUR GGPLOT
library(ggplot2)
library(broman) #crayon colours
library(cowplot)
library(magick)

# Theme for publication
theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
      theme(text=element_text(color="black"),
            axis.title=element_text( size = rel(1.75)),
            axis.text=element_text(size = rel(1.75), color = "black"),
            legend.title=element_text(face="bold"),
            legend.text=element_text(),
            legend.background=element_rect(fill="transparent"),
            legend.key.size = unit(1.2, 'lines'),
            panel.border=element_rect(color="black",size=1),
            panel.grid.minor.x =element_blank(),
            panel.grid.minor.y= element_blank(),
             panel.grid.major= element_blank()
      ))
}

#Load data
dat_cleaning_5 <- readRDS("../Data/RData/data_all_species_PPCA.rds")
phyl_pca_forest <- readRDS("../Data/RData/phyl_pca_forest.rds")

PC <- phyl_pca_forest
#CHECK CONTENT
#EIGENVALUES
PC$Eval
#PC score (POINTS)
PC$S
#PC loadings (ARROWS)
PC$L

#Images were made by Paula Martin
#Check her work on https://paulamartinart.com/

tree <- image_read("../Images/PPCA_Plot/Tree.png")
tree_1 <- as.raster(tree)

style_l <- image_read("../Images/PPCA_Plot/Style_Long.png")
style_l_1 <- as.raster(style_l)

style_s <- image_read("../Images/PPCA_Plot/Style_Short.png")
style_s_1 <- as.raster(style_s)

ovule_h <- image_read("../Images/PPCA_Plot/Ovule_High.png")
ovule_h_1 <- as.raster(ovule_h)

ovule_l <- image_read("../Images/PPCA_Plot/Ovule_Low.png")
ovule_l_1 <- as.raster(ovule_l)

selfing_n <- image_read("../Images/PPCA_Plot/Selfing_None.png")
selfing_n_1 <- as.raster(selfing_n)

selfing_h <- image_read("../Images/PPCA_Plot/selfing.png")
selfing_h_1 <- as.raster(selfing_h)

single_flower <- image_read("../Images/PPCA_Plot/Single_Flower.png")
single_flower_1 <- as.raster(single_flower)

many_flowers <- image_read("../Images/PPCA_Plot/Inflorescencia.png")
many_flowers_1 <- as.raster(many_flowers)
#many_flowers_1 <- image_rotate(many_flowers, 45)

large_flower <- image_read("../Images/PPCA_Plot/flower_big.png")
large_flower_1 <- as.raster(large_flower)

#"Images/PPCA_Plot/flower_short.png"
flower_small <- image_read("../Images/PPCA_Plot/flower_big.png")
flower_small_1 <- as.raster(flower_small)

herb <- image_read("../Images/PPCA_Plot/herb.png")
herb_1 <- as.raster(herb)

#############################################################################################################################################################
#COMPATIBILITY
#############################################################################################################################################################
#Load plots

#Invert axes
PC$S[,1] <- -PC$S[,1]
PC$S[,2] <- -PC$S[,2]

all_spp <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density

  
  plot <- plot+stat_density2d(aes(fill=..level..,alpha=..level..),geom='polygon') + 
  scale_fill_continuous(low="green",high="red",guide=FALSE,breaks = c(0.02, 0.050, 0.09), labels = c("Low", "Medium", "High")) + theme(legend.position = "none")+guides(fill = guide_legend(override.aes = list(alpha = 0.7),title="Kernel density"))+
    scale_alpha(guide = 'none')
  
  
    plot <- plot + geom_point(data=dat, aes(x, y),size=1.3, color="black")

  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .7 * mult * (get(x)),
                      v2 = .7 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.8, arrow=arrow(length=unit(0.5,"cm")), alpha=0.8, colour=c("black"))
  

  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=1.6, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.5, colour=c("black"))
  
   #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage
  
  plot <- plot + xlab(paste("Flower number - Flower size axis ", "(",(percentage[1]),"%",")", sep = "")) #XLAB
  plot <- plot + ylab(paste("Autonomous selfing - Floral display axis ", "(",(percentage[2]),"%",")", sep = "")) #YLAB
  

  #CHANGE THEME
    
  plot <- plot + theme_bw() + annotation_raster(tree_1, xmin = -4.1, xmax = -2.85,ymin = 2.05, ymax = 4.05)+
     annotation_raster(style_l_1, xmin = 2.25, xmax = 3.05,ymin = 2.55, ymax = 3.7) +
    annotation_raster(style_s_1, xmin = -2.6, xmax = -1.9,ymin = -2.65, ymax = -1.7) +
    annotation_raster(ovule_h_1, xmin = 3.5, xmax = 4.2,ymin = -0.45, ymax = 0.50) +
    annotation_raster(ovule_l_1, xmin = -4.2, xmax = -3.5,ymin = -0.45, ymax = 0.5) +
    annotation_raster(selfing_n_1, xmin = -0.75, xmax = 1.2,ymin = 2, ymax = 4.7) +
    annotation_raster(selfing_h_1, xmin = -0.30, xmax = 0.15,ymin = -3.9, ymax = -3.1) +
    annotation_raster(single_flower_1, xmin = 3.3, xmax = 4.1,ymin = -1.7, ymax = -0.7) +
    annotation_raster(many_flowers_1, xmin = -4.20, xmax = -3.40,ymin = 0.8, ymax = 1.45) +
    annotation_raster(large_flower_1, xmin = 3.18, xmax = 4.13,ymin = 1.3, ymax = 2.4) +
    annotation_raster(flower_small_1, xmin = -3.21, xmax = -2.81,ymin = -2, ymax = -1.45) +
    annotation_raster(herb_1, xmin = 2.6, xmax = 3,ymin = -2.8, ymax = -2) 

    
      #ADD LABELS
  rownames(PC$L) <- c("High selfing", "Many flowers", "Large flowers", "Long styles", "Many ovules", "Tall plants" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
 plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.7,5.05,5.6,7.85,7.3,6.15)), y = -(PCAloadings$PC2*c(4.693,2.5,3.1,6.6,5,5.5)+c(0,0,0,0,0.4,0)),
                         label = PCAloadings$Variables, color="black",fontface =2,size=4)
  
 
 plot <- plot + annotate("text", x = (PCAloadings$PC1*c(4.6,4.95,4.5,6.6,7.3,5.15)), y = (PCAloadings$PC2*c(3.83,6.4,5.7,7.4,-1,7.45)+c(0,0,0,0,-0.41,0)),
                         label =c("Low selfing", "Few flowers", "Small flowers", "Short styles", "Few ovules", "Short plants" ), color="black",fontface =2,size=4)
 
 
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.095, 0.11)) +ggtitle("") 
  
  
  
  plot
  
}

plot_grid(all_spp(PC))



```

As expected, due to individual trait correlations between qualitative and quantitative traits (e.g., life form and plant height), we found that most categorical traits were clustered on the trait space and statistically associated with the first two axes of trait variation (figure s2 and table s2). Flower symmetry, which was only associated with PC2 (Sum of squares = 8.51, F-value = 14.72, *P* \< 0.01 ), and nectar provision, which was independent of PC1 and PC2 (PC1: Sum of squares = 0.37, F-value = 0.29 , *P* = 0.59; PC2: Sum of squares = 0.83, F-value = 1.43, *P* = 0.23) showed a lack of statistical association. In addition, we found statistical differences between the different categorical trait levels within the trait space (figure S7). Regarding self-compatibility, we found larger differences on PC2. For instance, species with unisexual flowers that were self-incompatible, were statistically differentiated from species with partial or full self-compatibility on this axis (figure S7a and figure S7b; Tukey test *P* \< 0.05). Life forms differed statistically across both axes of trait variation and followed a gradient of larger life forms (trees and shrubs) with lower autonomous selfing to smaller ones (herbs) with higher autonomous selfing (figure S7c and figure S7d; Tukey test *P* \< 0.05). Consequently, lifespan also followed this gradient but perennial and short lived species only differed statistically on PC2 (figure S7e and figure S7f; Tukey test *P* \< 0.05). Species with unisexual flowers (monoecious and dioecious) were clustered on both extremes of the first two principal components and had both the lowest autonomous selfing levels and the highest number of flowers (figure S7g and figure S7h; Tukey test *P* \< 0.05). Moreover, we found that campanulate and capitulum flower shapes were differentiated from tube, papilionaceous, open and brush shapes in the trait space; the former had larger flowers and low autonomous selfing levels, while the latter had more flowers and high autonomous selfing (figure S7i and figure S7j; Tukey test *P* \< 0.05). Finally, in terms of flower symmetry, zygomorphic flowers were associated with high levels of autonomous selfing, whereas actinomorphic flowers were more dependent on pollinators (figure S7k and figure S7l; Tukey test *P* \< 0.05).

\blandscape



```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=12, fig.width=18, out.width="80%",fig.align='center',fig.cap= "\\textbf{Figure 2.} Location of the different qualitative traits in the trait space. The figure panel is composed of the traits that showed statistical association with the first two axes of trait variation: compatibility system (a), life form (b), lifespan (c), breeding system (d), flower shape (e) and flower symmetry (f). The solid arrows indicate the direction of variation of the different quantitative traits shown in figure 1: flower number (FN), plant height (PH), style length (SL), flower size (FS), ovule number (ON) and the level of autonomous selfing (S)."}



#Load libraries
#LOAD LIBRARIES
library(phytools)
library(ape) #for phylogenetic distance
library(dplyr) #data processing
library(rtrees) #for phylogenetic distancelibrary(MASS)
library(reshape2)
library(viridis) #COLOUR GGPLOT
library(MASS)
library(ggplot2)
library(broman) #crayon colours
library(cowplot)
library(ggstar)

# Theme for publication
theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
      theme(text=element_text(color="black"),
            axis.title=element_text( size = rel(1.6)),
            axis.text=element_text(size = rel(1.6), color = "black"),
            legend.title=element_text(face="bold"),
            legend.text=element_text(size = rel(1.1)),
            legend.background=element_rect(fill="transparent"),
            legend.key.size = unit(0.4, 'lines'),
            panel.border=element_rect(color="black",size=1),
            panel.grid.minor.x =element_blank(),
            panel.grid.minor.y= element_blank(),
             panel.grid.major= element_blank(),
            plot.title = element_text(size = rel(2.5), face="bold")
      ))
}

#Load data
dat_cleaning_5 <- readRDS("../Data/RData/data_all_species_for_rmd_plot_ppca_QUALITATIVE.rds")
phyl_pca_forest <- readRDS("../Data/RData/phyl_pca_forest.rds")

#CALL the output PC for simplicity
PC <- phyl_pca_forest
#CHECK CONTENT
#EIGENVALUES
PC$Eval
#PC score (POINTS)
PC$S
#PC loadings (ARROWS)
PC$L

#############################################################################################################################################################
#COMPATIBILITY
#############################################################################################################################################################
#Load plots
Compatibility <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$Compatibility <- dat_cleaning_5$Compatibility_system
  dat$Compatibility <- as.character(dat$Compatibility)
  dat$Compatibility[dat$Compatibility=="dioecious"] <- "Unisexual flowers"
  dat$Compatibility[dat$Compatibility=="monoecious"] <- "Unisexual flowers"
  dat$Compatibility[dat$Compatibility=="partially_self_compatible"] <- "Partially self compatible"
  dat$Compatibility[dat$Compatibility=="self_compatible"] <- "Self compatible"
  dat$Compatibility[dat$Compatibility=="self_incompatible"] <- "Self incompatible"
  dat$Compatibility <- factor(dat$Compatibility, levels = c("Self compatible", "Partially self compatible", "Self incompatible", "Unisexual flowers"))

  plot <- plot + geom_star(data=dat, aes(-x, -y, starshape=Compatibility, fill=Compatibility), size=2.25, color= NA, alpha = 0.85)+ scale_fill_manual(values=c("deepskyblue2", "purple2","goldenrod","gray7")) +
scale_starshape_manual(values = c(13, 15, 28, 5))  
  
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.220, 0.130)) +ggtitle("(a)") + xlab(NULL)  + ylab("Autonomous selfing - Floral display axis")
  
  
  plot
  
}

#Compatibility(PC)

#############################################################################################################################################################
#Life form
#############################################################################################################################################################
#Load plots
Life_form <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Life form` <- dat_cleaning_5$life_form
  dat$`Life form` <- as.character(dat$`Life form`)
  dat$`Life form`[dat$`Life form`=="herb"] <- "Herb"
  dat$`Life form`[dat$`Life form`=="shrub"] <- "Shrub"
  dat$`Life form`[dat$`Life form`=="tree"] <- "Tree"
  dat$`Life form`[dat$`Life form`=="vine"] <- "Shrub"
  
  dat$`Life form` <- factor( dat$`Life form`, levels = c("Herb", "Shrub", "Tree"))

plot <- plot + geom_star(data=dat, aes(-x, -y, starshape=`Life form`, fill=`Life form`), size=2.25, color= NA, alpha = 0.85)+ scale_fill_manual(values=c("forestgreen", "darkorange2","black")) +
scale_starshape_manual(values = c(13, 15, 28))
  
  
    
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.090, 0.115)) + ggtitle("(b)") +
    xlab(NULL) + ylab(NULL)
  
  plot
  
}

#Life_form(PC)

#############################################################################################################################################################
#Life span
#############################################################################################################################################################
#Load plots
Life_span <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
    dat$Lifespan <- dat_cleaning_5$lifespan
    dat$Lifespan <- as.character(dat$Lifespan)

  plot <- plot + geom_star(data=dat, aes(-x, -y, starshape=Lifespan, fill=Lifespan), size=2.25, color= NA, alpha = 0.9)+ scale_fill_manual(values=c("sienna4","forestgreen")) +
scale_starshape_manual(values = c(13, 15))  
  
  
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.12, 0.1)) + ggtitle("(c)") +
    xlab(NULL) + ylab(NULL)
  
  plot
  
}

#Life_span(PC)

#############################################################################################################################################################
#Flower symmetry
#############################################################################################################################################################
#Load plots
Flower_sym <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Flower symmetry` <- dat_cleaning_5$Flower_symmetry
  dat$`Flower symmetry` <- as.character(dat$`Flower symmetry`)
  dat$`Flower symmetry`[dat$`Flower symmetry`=="actinomorphic"] <- "Actinomorphic"
  dat$`Flower symmetry`[dat$`Flower symmetry`=="zygomorphic"] <- "Zygomorphic"
  

  plot <- plot + geom_star(data=dat, aes(-x, -y, starshape=`Flower symmetry`, fill=`Flower symmetry`), size=2.25, color= NA, alpha = 0.9) + scale_fill_manual(values=c("goldenrod","purple2")) +
scale_starshape_manual(values = c(13, 15))  
  
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.155, 0.1)) + ggtitle("(f)") + ylab(NULL) + xlab("Flower number - Flower size axis")
  
  plot
  
}

#Flower_sym(PC)

#############################################################################################################################################################
#Flower shape
#############################################################################################################################################################
#Load plots
Flower_sha <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Flower shape` <- dat_cleaning_5$Flower_morphology
  dat$`Flower shape` <- as.character(dat$`Flower shape`)
  dat$`Flower shape`[dat$`Flower shape`=="Funnelform"] <- "Campanulate"
  dat$`Flower shape`[dat$`Flower shape`=="Spike"] <- "Brush"

  plot <- plot + geom_star(data=dat, aes(-x, -y, starshape=`Flower shape`, fill=`Flower shape`), size=2.25, color= NA, alpha = 0.85)+ scale_fill_manual(values=c("black","goldenrod", "deepskyblue2","forestgreen","purple2","darkorange2")) +
scale_starshape_manual(values = c(13, 15, 28, 5, 9, 14))  
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.155, 0.17)) + ggtitle("(e)") + ylab(NULL) + xlab("Flower number - Flower size axis")
  
  plot
  
}

#Flower_sha(PC)

#############################################################################################################################################################
#Breeding system
#############################################################################################################################################################
#Load plots
Breeding_syst <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Breeding system` <- dat_cleaning_5$Breeding_system
  dat$`Breeding system` <- as.character(dat$`Breeding system`)
  dat$`Breeding system` <- factor(dat$`Breeding system`, levels=c("Hermaphrodite","Monoecious" ,"Dioecious"))

  plot <- plot + geom_star(data=dat, aes(-x, -y, starshape=`Breeding system`, fill=`Breeding system`), size=2.25, color= NA, alpha = 0.9) + scale_fill_manual(values=c("forestgreen","darkorange2", "black")) +
scale_starshape_manual(values = c(13, 15, 28))  
    
  
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  

  
  #CHANGE THEME
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.152, 0.11)) + ggtitle("(d)") +
    xlab("Flower number - Flower size axis") +
    ylab("Autonomous selfing - Floral display axis")
  
  plot
  
}

#Breeding_syst(PC)

#############################################################################################################################################################
#Nectar
#############################################################################################################################################################
#Load plots
#Nectar <- function(PC, x="PC1", y="PC2") {
#  # PC being a prcomp object
#  data <- data.frame(PC$S)
#  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
#  dat <- data.frame(x = data[,x], y = data[,y])
#  
#  #######
#  #DENSITY FUNCTION
#  #######
#  get_density <- function(x, y, ...) {
#    dens <- MASS::kde2d(x, y, ...)
#    ix <- findInterval(x, dens$x)
#    iy <- findInterval(y, dens$y)
#    ii <- cbind(ix, iy)
#    return(dens$z[ii])
#  }
#  
#  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
#  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
#  dat$Nectar <- dat_cleaning_5$Nectar_presence_absence
#  dat$Nectar[dat$Nectar=="yes"] <- "Presence"
#  dat$Nectar[dat$Nectar=="no"] <- "Absence"
#  plot <- plot + geom_point(data=dat, aes(-x, -y, #colour=Nectar),size=1.75)+scale_color_manual(values=c("black","grey"))
#  
#  ########
#  #ADD ARROWS 
#  ########
#  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
#  mult <- min(
#    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
#    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
#  )
#  datapc <- transform(datapc,
#                      v1 = .75 * mult * (get(x)),
#                      v2 = .75 * mult * (get(y))
#  )
#  # add arrows
#  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, #yend=-v2),size=1, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
#  
#  #Add axis with perctentage
#  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage
#
#  
#  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
#  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.6, #arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
#  
#  #ADD LABELS
#  rownames(PC$L) <- c("Selfing", "Flower N.", "Flower size", "Style Length", "Ovule N.", "Plant Height" )
#  
#  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
#  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,4.95,5,7.5,7.1,6)), y = #-(PCAloadings$PC2*c(4.3,2.6,5,7,5.8,6.5)+c(0,0,0,0,-0.15,0)),
#                          label = PCAloadings$Variables, color="black",size=3)
#  
#  #CHANGE THEME
#  #CHANGE THEME
#  
#  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.095, 0.115)) + ggtitle("G)") 
#  
#  plot
#  
#}
#
# #plot_grid(Compatibility(PC),Life_form(PC),Life_span(PC),Breeding_syst(PC),Flower_sha(PC),Flower_sym(PC),Nectar(PC), ncol=2,nrow=4,  align = "hv")




  plot_grid(Compatibility(PC),Life_form(PC),Life_span(PC),Breeding_syst(PC),Flower_sha(PC),Flower_sym(PC),ncol=3,nrow=2,  align = "hv")

```




\elandscape

## (b) Phylogenetic signal

We found a strong phylogenetic signal (*P* \< 0.01) for most quantitative traits (table S5). The traits that showed the highest phylogenetic signal were ovule number ($\lambda$ = 1), pollen grains per flower ($\lambda$ = 1) and plant height ($\lambda$ = 0.96), followed by flower length ($\lambda$ = 0.75), flower width ($\lambda$ = 0.73) and number of flowers per plant ($\lambda$ = 0.69). The traits that had a moderate phylogenetic signal included inflorescence width ($\lambda$ = 0.57), style length ($\lambda$ = 0.49) and autonomous selfing ($\lambda$ = 0.34). Finally, microliters of nectar per flower showed the lowest phylogenetic signal of all the traits we measured ($\lambda$ = 0.14).

## (c) Visitation patterns

The main axes of trait variation (PC1, PC2 and PC3) partly explained the presence-absence of interaction partners (conditional $R^{2}$ = 0.26; marginal $R^{2}$ = 0.20) but little of the total number of visits (conditional $R^{2}$ = 0.31; marginal $R^{2}$ = 0.06). However, we found relevant differences across the different pollinator guilds for both the presence-absence of interactions and number of visits (figure 3). On the flower number - flower size axis, we found  that plants with many small flowers tended to have interaction partners that were Coleoptera, non-bee-Hymenoptera and Diptera (figure 3a), whereas plants with few large flowers mostly had interaction partners that were bees and Lepidoptera. We found similar trends for visitation rates on the flower number - flower size axis,  but bees and syrphids visited plant species with many small flowers more frequently (figure 3d). On the autonomous selfing - floral display axis, we found that all plant species with lower autonomous selfing had many interaction partners and recieved many visits from all pollinator guilds (figure 3b and figure 3e). Finally, on the style length - autonomous selfing axis, plant species with short styles and low autonomous selfing had more interaction partners for all guilds, except bees which interacted more frequently with plant species with long styles and high autonomous selfing (figure 3c). Plants with long styles and high autonomous selfing interacted more frequently with Lepidoptera and non-bee-Hymenoptera (figure 3f).

The additional models for the most represented bee families, for both presence-absence of interactions (marginal $R^{2}$ = 0.29; conditional $R^{2}$ = 0.19) and the number of visits (marginal $R^{2}$ = 0.30; conditional $R^{2}$ = 0.03), showed that the Apidae family was the main driver of the observed patterns. The contrast between interaction presence/absence  and number of visits for bees on PC1 (figure 3a and figure 3d) was driven by the Andrenidae family, which had more interaction partners but made fewer visits to plant species with few large flowers (figure S8).

```{=tex}
\vspace{5mm}
\blandscape
```
```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=14, fig.width=27,fig.cap= "**Figure 3.** Fitted posterior estimates of the presence-absence of interaction (a, b and c) and number of visits (d, e and f) of the different pollinator guilds in relation to the main axes of plant reproductive trait variation (PC1, PC2 and PC3). PC1 represents the flower number - flower size axis, PC2 represents the autonomous selfing - floral display axis and PC3 represents the style length - autonomous selfing axis. For visualization purposes due to large differences between number of visits from bees and the rest of the pollinator guilds, the number of visits was log-transformed (Y-axis of lower panel)."}

#LOAD LIBRARIES 
#library(phytools)
#library(ape) #for phylogenetic distance
#library(dplyr) #data processing
#library(rtrees) #for phylogenetic distancelibrary(MASS)
#library(reshape2)
library(viridis) #COLOUR GGPLOT
#library(MASS)
library(ggplot2)
library(broman) #crayon colours
#library(tidyverse)
library(patchwork) #panel of plots
#library(brms)
#library(cmdstanr)

#Load theme for publication

theme_ms <- function(base_size=14, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
     theme(text=element_text(color="black"),
           axis.title=element_text( size = rel(2)),
           axis.text=element_text(size = rel(1.8), color = "black"),
           legend.title=element_text(face="bold",size=rel(2)),
           legend.text=element_text(size=rel(1.4)),
           legend.background=element_rect(fill="transparent"),
           legend.key.size = unit(2, 'lines'),
           panel.border=element_rect(color="black",size=2.4),
           panel.grid.minor.x =element_blank(),
           panel.grid.minor.y= element_blank(),
           panel.grid.major= element_blank(),
           plot.title = element_text(hjust = 0.5,size=rel(2.75),face="bold"),
           plot.subtitle = element_text(face="bold",size=rel(2))
     ))
}


p1 <- readRDS("../Main_Figures/figure_3_1.rds")
p2 <- readRDS("../Main_Figures/figure_3_2.rds")
p3 <- readRDS("../Main_Figures/figure_3_3.rds")
pp1 <- readRDS("../Main_Figures/figure_3_4.rds")
pp2 <- readRDS("../Main_Figures/figure_3_5.rds")
pp3 <- readRDS("../Main_Figures/figure_3_6.rds")

library(patchwork)

combined <- pp1 + pp2 + pp3 + p1 + p2 + p3  & theme(legend.position = "bottom") &  guides(color = guide_legend(override.aes = list(size=6.5), keywidth=1.8,
                 keyheight=0.1,
                 default.unit="inch"))

combined + plot_layout(guides = "collect",ncol = 3)
```

\elandscape

## (d) Plant species network roles

Variance within plant species-level network metrics was poorly explained by the three main axes of trait variation (figure S9; number of visits \~ PCs, conditional $R^{2}$ = 0.11, marginal $R^{2}$ = 0.02; normalised degree \~ PCs, conditional $R^{2}$ = 0.24, marginal $R^{2}$ = 0.02; and, selectivity \~ PCs, conditional $R^{2}$ = 0.37, marginal$R^{2}$ = 0.03). Overall, the most notable trends were found on the flower number - flower size axis (PC1) and the style length - autonomous selfing axis (PC3) for number of visits and selectivity. On PC1, the number of visits per flower was higher for plant species with more flowers but was lower for plant species with larger flowers (figure S9a). However, selectivity (d’) was higher for plant species with large flowers but lower for plant species with small flowers (figure S9g). On PC3, the number of visits was lower for plants with shorter styles and lower autonomous selfing but higher for plant species with longer styles and higher autonomous selfing (figure S9c). Again, selectivity showed the opposite trend to the number of visits (figure S9i).

# 4. Discussion

We found strong covariation among traits within the flowering plant reproductive spectrum, which shapes interactions with pollinators at a global scale. Despite the enormous variability in plant reproductive structures, the first two and three axes captured over 50% and 70% of trait variation, respectively, and these axes encapsulated correlations among flower number and flower size, autonomous selfing and floral display, and style length and autonomous selfing. Although explained trait variation on the first two axes was less than previous studies of morphological and physiological traits [@diaz2016; @carmona2021], our results align with the two largest and most recent studies of plant life strategies that included reproductive, form and size related traits [@salguero2016; @vojtko2022]. The different plant reproductive axes that we identified were associated with different numbers of interacting partners and visitation rates of the distinct pollinator guilds. However, the unexplained variability found highlights the need to account for other local factors, such as species relative abundances [@bartomeus2016], along with reproductive traits, to better explain plant-pollinator associations.

Our study provides strong evidence for several widely discussed trait associations with the help of a great diversity of phylogenetic lineages (170 families and over 1,200 species). Specifically, by using a multitrait approach, we are able to link the reproductive spectrum of plant trait variation with the previously described “fast-slow continuum” in plant [@salguero2016] and animal [@healy2019] life-history strategies. This fast-slow continuum was illustrated by the associations between reproductive traits and plant height, life form and lifespan traits. For instance, although the negative correlation between flower number and flower size has received substantial attention [@worley2000; @sargent2007; @kettle2011], it has only been investigated across a few hundred Angiosperm species and generally lacking a multitrait perspective. We found support for this trait association and show that other reproductive traits (e.g., style length or ovule number) covary along this flower number - flower size axis. Our study also complements previous work linking plant breeding systems and life forms [@petit2006; @friedman2020] by showing that most species with unisexual flowers also have woody life forms and many flowers. Moreover, we identify the previously documented positive association between outcrossing rate and floral display size [@goodwillie2010], where species with low autonomous selfing levels also allocate large resource quantities to attract pollinators.

Although we did not include floral rewards in our main analysis due to insufficient data, we did find that plant species with large floral displays and, in particular, large flowers, tended to have higher pollen and nectar quantity. Thus, we demonstrate that globally, reproductive trait covariation in flowering plants likely imposes constraints on the broader spectrum of plant trait variation.

Overall, plant reproductive traits explained interaction patterns among and within pollinator guilds suggesting that plant reproductive strategies partly mediate these associations across spatial large scales. For example, we found that all pollinator guilds interacted more frequently with species with large floral displays and low ability to self pollinate, which aligns with previous findings [@hegland2005; @lazaro2013; @kaiser2014]. As predicted by evolutionary life-history theory [@stebbins1970], larger investment in floral display and rewards to attract pollinators occurs when pollinator dependence is high. Indeed, the possible range of reproductive strategies in flowering plants is constrained by the cost of reproductive organs, trait associations and selective pressures exerted by different pollinator guilds [@galen1999]. For instance, smaller flowers are visited less overall, but they are inexpensive to produce (e.g., have a low ovule number) and low visitation rate at the individual flower level can be compensated by overall visitation at the plant level by producing many flowers resulting in a larger quantity of small fruits [@kettle2011]. In addition, we found that a substantial number of species with high autonomous selfing had large styles and were associated with a high number of interactions with bees. These species seem to rely on animal pollinators as indicated by their high investment in sizable styles that can help prevent pollen competition [@ramesha2011; @ashman2013; @lanuza2021] while having reproductive assurance in their absence. For instance, the annual herb _Scabiosa atropurpurea_ has flowers grouped in clusters with relatively long styles and a single ovule per flower that is likely to be fertilised with a single legitimate floral visit but avoids reproductive failure with autonomous self pollination. Similarly, zygomorphic flowers are specialised floral structures that promote precise pollen transfer [@sargent2004; @gong2009] but they were associated with high levels of autogamy. Our findings are consistent with the idea that reproductive assurance is not rare within specialised pollination systems [@fenster2007] and highlight the need to explore the timing (e.g., early versus delayed) and selfing mechanisms [see @goodwillie2018] in relation to other reproductive traits to better understand reproductive trait correlations and plant-pollinator interactions.

Because floral traits can be associated with their animal pollinators to optimise pollen transfer, the correlation between distinct suites of reproductive traits and pollinator guilds could indicate the existence of pollination syndromes [@fenster2004; @faegri2013; @rosas2014; @dellinger2020]. For instance, bees had a higher number of interacting partners on plant species with large flowers but interacted more frequently with species with small flowers while syrphid flies showed the opposite trend. This could be reflective of differences in the ecology and behaviour between these pollinator guilds [@rader2020; @foldesi2021] that ultimately exert different selective pressures, leading divergent plant reproductive strategies. In any case, it is worth noting that local factors (e.g., species relative abundances or phenologies) likely contribute to the variability in the association between the plant reproductive spectrum and pollinators [@vazquez2007; @encinas2012; @bartomeus2016]. Taking both aspects together, we suggest that while plant reproductive traits do shape their interactions with pollinators, pollinator syndromes at a macroecological scale are not distinct compartmentalised items, but form part of a multifaceted context dependent continuum.

Our study provides a comprehensive assessment of  reproductive trait covariation patterns in flowering plants, using a global dataset of traits for plant species within plant-pollinator networks. We show the importance of pollinators in mediating reproductive trait correlations and identify the need to consider broader plant reproductive strategies, rather than just flower morphology, to understand patterns of plant-pollinator interactions. Further, we provide empirical evidence of reproductive trait associations that complement trait covariation studies for other plant organs, highlighting the need to include reproductive traits in the global spectrum of plant form and function. Future work incorporating underrepresented areas of the world and additional relevant reproductive traits (e.g., flower life span and colour) from a broader range of life forms will be valuable for enhancing our understanding of the plant reproductive spectrum and associated plant-pollinator interactions.

\newpage

# References

::: {#refs}
:::
