---
title: \singlespacing \vspace{-1.6cm} \LARGE Covariation among reproductive traits in flowering plants determine interactions with floral visitors

#author: 
#  - Jose B. Lanuza^1,2^*
#  - Romina Rader^1^
#  - Jamie Stavert^3^
#  - Liam K. Kendall^4^
#  - Manu E. Saunders^1^
#  - Ignasi Bartomeus^2^

# may use lua filters for affiliations etc: see https://stackoverflow.com/a/52919256

# date: '`r Sys.Date()`'

output:
  bookdown::pdf_document2:
    fig_caption: yes
    fig_width: 7
    fig_height: 7
    df_print: kable
    keep_tex: yes
    number_sections: no
    extra_dependencies: ["float"]
    toc: no
    fig_crop: no
    includes:
      in_header: header.tex
    
documentclass: article
# classoption: twocolumn, landscape, etc
papersize: a4
pagestyle: plain  # plain, empty, headings
geometry: margin=1in
linestretch: 2
fontfamily: mathpazo
fontsize: 12pt

bibliography: 
  - references.bib
  - knitcitations.bib
# zotero: "My shared Zotero group"
csl: proceedingsb.csl #ecology letters
notes-after-punctuation: false
link-citations: yes
linkcolor: RoyalBlue
urlcolor: RoyalBlue
links-as-notes: false
subparagraph: yes

header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
- \usepackage{float}
- \floatplacement{figure}{H}
- \usepackage[skip=3pt]{caption}
- \captionsetup[figure]{labelformat=empty}
- \usepackage{setspace}
- \usepackage{titlesec}
- \titlespacing{\title}{0pt}{\parskip}{-\parskip}
- \usepackage[style=nature]{biblatex}
- \usepackage[labelformat = empty]{caption}
- \usepackage{pdflscape}
- \usepackage[T1]{fontenc}
- \DeclareUnicodeCharacter{0301}{*************************************}
- \DeclareUnicodeCharacter{1EF3}{*************************************}
- \usepackage{orcidlink}
---

\vspace{-1.4cm}

\singlespacing

\textbf{Jose B. Lanuza$^{1,2}$} \orcidlink{0000-0002-0287-409X}, \textbf{Romina Rader$^{1}$} \orcidlink{0000-0001-9056-9118}, \textbf{Jamie Stavert$^{3}$} \orcidlink{0000-0002-2103-5320}, \textbf{Liam K. Kendall$^{4}$} \orcidlink{0000-0002-0671-0121}, \textbf{Manu E. Saunders$^{1}$} \orcidlink{0000-0003-0645-8277} \textbf{and Ignasi Bartomeus$^{2}$} \orcidlink{0000-0001-7893-4389}

\small

^1^ School of Environmental and Rural Science, University of New England, Armidale, New South Wales 2350, Australia. ^2^ Estación Biológica de Doñana (EBD-CSIC), E-41092 Seville, Spain. ^3^ Department of Conservation \| Te Papa Atawhai, Auckland, New Zealand. ^4^ Centre for Environmental and Climate Science, Lund University, Sölvegatan 37, S-223 62 Lund, Sweden.

```{=tex}
\doublespacing
\normalsize
```
\textbf{Keywords:} life-history strategies \| plant reproductive traits \| plant-pollinator interactions

\textbf{Author for correspondence:} Jose B. Lanuza \| [barragansljose\@gmail.com](mailto:barragansljose@gmail.com){.email}

# Abstract

Plants have an enormous variation of life history strategies and trait combinations. However, there is strong evidence that there are evolutionary and physiological constraints that limit the number of plant ecological strategies. Despite recent advances in the understanding of plant trait correlations, reproductive traits are often not considered despite its key role in shaping both plant life-history strategies and plants interactions with floral visitors. Here, we investigate the reproductive spectrum of flowering plants and how this drive the establishment of interactions with their floral visitors using a dataset of 16 reproductive traits for 1,506 plant species. We found that over 50% of all trait variation was explained by the first two reproductive axes. Specifically, the first axis indicated the presence of a negative correlation between flower number and flower size while the second axis showed a positive correlation between pollinator dependence and floral display. These different reproductive axes determined important differences in the interaction level among floral visitor guilds but were insufficient to fully capture plant-pollinator associations. Our study shows the main reproductive trait correlations of flowering plants and highlights their relevance to understand plant-pollinator interactions in a global context.

```{=tex}
\doublespacing
\vspace{5mm}
\normalsize
```
```{r setup, include=FALSE, cache=FALSE, message = FALSE}

library("knitr")

### Chunk options: see http://yihui.name/knitr/options/ ###
## Text results
opts_chunk$set(echo = FALSE, warning = TRUE, message = TRUE)

## Code decoration
opts_chunk$set(tidy = TRUE, comment = NA, highlight = TRUE)

## Cache
# opts_chunk$set(cache = 2, cache.path = "output/cache/")

## Plots
opts_chunk$set(fig.path = "output/figures/")

```

```{r knitcitations, cache = FALSE}
library(knitcitations)
cleanbib()   
cite_options(citation_format = "pandoc")

```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
```

# 1. Introduction

Flowering plants have an astonishing diversity of floral structures [@barrett2002; @schiestl2013] that shape their interactions with animal pollinators [@fenster2004; @dellinger2020]. The variety of reproductive strategies followed by different plant species, from specialized reliance on a single pollinator, to full self-pollination, is incredibly rich. However, not all reproductive trait combinations are possible due to evolutionary and ecological constraints [@stearns1989; @agrawal2020]. Despite the recent advances in the theoretical and empirical understanding of the macroecological correlations between plant reproductive traits [@salguero2016; @friedman2020; @paterno2020; @roddy2021; @song2022], their study is often limited to a few number of reproductive traits that are rarely studied in combination. Thus, in order to progress towards a comprehensive understanding of the plant reproductive spectrum of trait variation as done recently for other root [@laughlin2021], leaf [@wright2004] or wood [@chave2009] related traits, there is a need to acquire a multitrait perspective with broad geographical coverage. Importantly, the characterization of the plant reproductive spectrum can help to further understand the different plant ecological strategies [@agrawal2020] and improve our knowledge on plant-pollinator associations [@roddy2021].

With the recent availability of large trait databases [e.g., TRY @kattge2011;  COMPADRE @salguero2015], plant ecological strategies are being increasingly examined, and are facilitating the identification of global patterns and constraints in plant form and function [@salguero2016; @diaz2016; @bruelheide2018; @carmona2021]. However, most studies with a multitrait perspective have overlooked plant reproductive traits [@evojtko2020; @roddy2021] and focused on trait correlations from other plant organs. Despite the lack of an holistic view that depict reproductive trait covariation patterns, there are widely recognized reproductive trait associations between pair of traits such as the negative correlation between flower size and flower number [@sargent2007; @kettle2011], the positive association between flower size and outcrossing rate [@goodwillie2010] or the positive association between outcrossing rate and lifespan [@barrett2003; @moeller2017]. Although these different trait correlations (and others) have recently allowed to progress towards a conceptual framework that integrates the different floral trait relationships [@roddy2021], we still lack empirical evidence that investigates jointly how these different reproductive trait associations shape plant life history strategies.

Despite this increasing number of macroecological studies that investigate specific plant reproductive traits [@baude2016; @munoz2016; @grossenbacher2017; @moeller2017], we still have poor understanding of how reproductive traits drive interactions with floral visitors at large ecological scales [@sargent2008; @rech2016; @salguero2016; @ruger2018]. The use of trait-based approaches [@fenster2004; @rosas2014] and trait-matching analyses [@stang2009; @bartomeus2016] has shown to be of great importance when exploring the drivers of plant-pollinator interactions. For example, plant traits can define species' network roles [e.g., specialists vs generalists @tur2013] and plant species that occupy reproductive trait space extremes are more likely to exhibit higher levels of specialisation and be more reliant on the trait-matching with pollinators [@junker2013; @coux2016]. Indeed, morphological matching between plants and floral visitors often determines plant-pollinator interactions, and can thus strongly influence interaction network structure [@stang2009; @ibanez2012]. However, is still unclear how specific key reproductive traits like mating or compatibility system influence plant-pollinator associations [@tur2013; @devaux2014]. Indeed, the pollination system of a great number of plant species remains unexplored [@dellinger2020]. Because both the species' morphology and mating system can determine the species' functional role in the pollination network and the combination of several traits has shown to increase the predictive power of the structure of ecological networks [@eklof2013], an interesting novel approach is to investigate how a complete set of reproductive traits in the multidimensional trait space determine species interaction patterns [see @dehling2016 for a morphological approach]. Thus, by exploring the plant reproductive spectrum of trait variation it is possible to delimit the different reproductive strategies and explore how these are associated with the different floral visitors.

Here, we aim to progress knowledge on the reproductive trait covariation patterns and their association with the different floral visitor guilds by exploring at a broad geographical scale the reproductive spectrum of trait variation of flowering plants from plant-pollination networks. First, we investigate what are the major axes of reproductive trait variation and trait correlations for the different plant species. Second, we investigate the association between the plant species' position in the multidimensional trait-space and the different floral visitor guilds with the help of qualitative (presence-absence of interaction) and quantitative (number of visits) information about plant-pollinator interactions. Finally, we investigate how the main axes of trait variation influence plant species' functional roles in the pollination network using a set of complementary interaction network metrics (i.e., number of visits, normalized degree and specialization).

# 2. Methods

## (a) Plant-pollinator network studies

We selected 28 studies from 18 different countries that constituted a total of 64 plant-pollinator networks (see table S1 and figure S1). These studies recorded plant-pollinator interactions in natural systems and were selected so that we had broad geographical representation across different biological communities. Although these studies differ in sampling effort and methodology, all studies provided information about plant-pollinator interactions (weighted and non-weighted), which we used to build a database of plant species that are likely to be animal pollinated. Many of these networks are freely available either as published studies [e.g., @carvalheiro2014; @olesen2007; @fortuna2010] or available in online archives [e.g., Mangal @poisot2016;  The Web of Life @fortuna2010]. In total, our network dataset constituted 60 weighted (number of visits) and 4 unweighted (presence-absence of the interaction) networks, each sampled at a unique location and year, as well as eight meta-webs where interactions were pooled across several locations and multiple years.

## (b) Taxonomy of plants and pollinators

All species names, genera, families and orders were retrieved and standardized from the taxonomy data sources NCBI (<https://www.ncbi.nlm.nih.gov/taxonomy>) for plants and ITIS (<https://www.itis.gov/>) for pollinators, using the R package *taxize* [@chamberlain2020]. We filled the 'not found' searches manually using <http://www.theplantlist.org/> and <http://www.mobot.org/> for plants and <http://www.catalogueoflife.org/> for floral visitors.

## (c) Plant traits

We selected a total of 19 different quantitative and categorical functional traits that comprised reproductive traits and plant form and size related traits (see table 1). Reproductive traits consisted of floral traits and reproductive biology traits: (i) floral traits included traits related to the size of floral organs (e.g., style length), floral display (e.g., flower number) or floral rewards (e.g., pollen quantity) while (ii) reproductive biology traits indicated the reproductive system of the plant (i.e., breeding, mating and compatibility system). The remaining traits were plant size and form related traits that are commonly used to characterize the fast-slow continuum of plant trait variation (i.e., plant height, lifespan and life form). For each plant species, we undertook an extensive literature and online search for all traits across a wide range of resources (plant databases, online floras, books, journals and images). From a total of 30,120 possible cells considering all traits and plant species (20 columns × 1,506 species), we were able to fill 24,341 cells (80.8% of the dataset, see figure S2 for missing values information for each trait). An extended description of each trait and how it was obtained can be found in Appendix S1.

\singlespacing

```{r, echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE, fig.height=1, fig.width=14}
setwd("~/R_Projects/Reproductive Traits")


library(kableExtra)

library(dplyr)
library(readxl) #read excel file (trait data)
library(dplyr) #data manipulation
library(visdat) #VISUALIZE MISSING DATA
library(naniar)
library(tidyverse)
########################################################################################################################################################
#1) READ TRAIT DATA
########################################################################################################################################################
#load data
trait_data <- read_excel("Data/Trait_data_raw/Trait_data_final.xlsx",na = "NA")
########################################################################################################################################################
#2) A) CLEAN DATA AND B) RENAME LEVELS FOR IMPUTATION 
########################################################################################################################################################
#####
#A) CLEAN DATA
#####
#select just filled rows
trait_data_1 <- trait_data[1:1712,] #It may be a more elegant way but this does the job, 1712 rows of data

#filter data, select species with flower level info and capitulum
trait_filtered <- filter(trait_data_1, Info_level == "flower" |  Info_level == "capitulum")
#remove NA's and duplicated species|Some spp are repeated once the spp names are standardize with taxize
trait_filtered$Species_all[trait_filtered$Species_all=="NA"]<-NA 
trait_filtered_1 <- trait_filtered[!is.na(trait_filtered$Species_all),]
trait_filtered_2 <- trait_filtered_1[!duplicated(trait_filtered_1$Species_all),]

#Select columns to work with
t <- trait_filtered_2[c("Species_geonet","Order_all","Family_all","Genus_all","Species_all","Breeding_system","Compatibility_system",
                        "Autonomous_selfing_level","Autonomous_selfing_level_fruit_set", "Flower_morphology", "Flower_symmetry", 
                        "Flowers_per_plant","Floral_unit_width", "Corolla_diameter_mean", "Corolla_length_mean","Style_length", "Ovule_number", 
                        "life_form", "lifespan","Plant_height_mean_m","Nectar_presence_absence","Nectar_ul","Nectar_mg","Nectar_concentration","Pollen_per_flower")]

########################################################################################################################################################
#####
#B) RENAME LEVELS FOR IMPUTATION
#####
#Breeding_system| For the purpose of this study we are not going to consider other complex breeding systems and just focus on 
#Hermaphroditism, dioecy and monoecy, the closest levels are grouped within each category
t$Breeding_system <- as.character(t$Breeding_system)
t$Breeding_system[t$Breeding_system=="androdioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="androgynodioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="andromonoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="gynodioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="gynoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="gynomonoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="gynomonoecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="monoecious_dioecious"] <- "monoecious"
t$Breeding_system[t$Breeding_system=="polygamo-dioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="protandrous"] <- "hermaphrodite"
t$Breeding_system[t$Breeding_system=="protogynous"] <- "hermaphrodite"
t$Breeding_system[t$Breeding_system=="subdioecious"] <- "dioecious"
t$Breeding_system[t$Breeding_system=="submonoecious"] <- "monoecious"
#Change to capital letters| There are already levels with lower case
t$Breeding_system[t$Breeding_system=="monoecious"] <- "Monoecious"
t$Breeding_system[t$Breeding_system=="dioecious"] <- "Dioecious"
t$Breeding_system[t$Breeding_system=="hermaphrodite"] <- "Hermaphrodite"
t$Breeding_system <- as.factor(t$Breeding_system)

#Now 3 levels
#Flower_morphology
t$Flower_morphology <- as.character(t$Flower_morphology)
t$Flower_morphology[t$Flower_morphology=="bowl"] <- "open"
t$Flower_morphology[t$Flower_morphology=="dish"] <- "open"
t$Flower_morphology[t$Flower_morphology=="exposed"] <- "open"
t$Flower_morphology[t$Flower_morphology=="spadix"] <- "spike"
t$Flower_morphology[t$Flower_morphology=="open"] <- "Open"
t$Flower_morphology[t$Flower_morphology=="brush"] <- "Brush"
t$Flower_morphology[t$Flower_morphology=="campanulate"] <- "Campanulate"
t$Flower_morphology[t$Flower_morphology=="capitulum"] <- "Capitulum"
t$Flower_morphology[t$Flower_morphology=="funnelform"] <- "Funnelform"
t$Flower_morphology[t$Flower_morphology=="papilionaceous"] <- "Papilionaceous"
t$Flower_morphology[t$Flower_morphology=="spike"] <- "Spike"
t$Flower_morphology[t$Flower_morphology=="tube"] <- "Tube"
t$Flower_morphology <- as.factor(t$Flower_morphology)

#Life span
t$lifespan <- as.character(t$lifespan )
t$lifespan[t$lifespan=="annual"] <- "short_lived"
t$lifespan[t$lifespan=="biennial"] <- "short_lived"
t$lifespan[t$lifespan=="short_lived"] <- "Short lived"
t$lifespan[t$lifespan=="perennial"] <- "Perennial"
t$lifespan <- as.factor(t$lifespan )

########################################################################################################################################################
#3) EXPLORE PATTERNS OF MISSING DATA
########################################################################################################################################################

#We convert cualitative data to quantitative to reduce missing data on this column and hence conduct the imputation 
#use ifelse base r does not work with these NA'S Even with work around. base r does not like the na option of read excel
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("high") & is.na(t$Autonomous_selfing_level_fruit_set), 88, t$Autonomous_selfing_level_fruit_set)
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("medium") & is.na(t$Autonomous_selfing_level_fruit_set), 50.5, t$Autonomous_selfing_level_fruit_set)
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("low") & is.na(t$Autonomous_selfing_level_fruit_set), 13, t$Autonomous_selfing_level_fruit_set)
t$Autonomous_selfing_level_fruit_set <- ifelse(t$Autonomous_selfing_level %in% c("none") & is.na(t$Autonomous_selfing_level_fruit_set), 0, t$Autonomous_selfing_level_fruit_set)

#t$Nectar_ul adding it here just to see how many cells 
#Now we just select presence/absence of nectar
#select columns of interest
t <- t[c("Species_geonet","Order_all","Family_all","Genus_all","Species_all","Breeding_system","Compatibility_system","Autonomous_selfing_level",
         "Autonomous_selfing_level_fruit_set", "Flower_morphology", "Flower_symmetry", "Flowers_per_plant", "Floral_unit_width",
         "Corolla_diameter_mean", "Corolla_length_mean", "Style_length", "Ovule_number", "life_form", "lifespan",
         "Plant_height_mean_m","Nectar_presence_absence","Nectar_ul","Nectar_mg","Nectar_concentration","Pollen_per_flower")]


########################################################################################################################################################
#4) CALCULATE PHYLOGENETIC DISTANCE TO CORRECT WITH EIGENVALUES IN THE IMPUTATION
########################################################################################################################################################
#Convert to factor 
cols <- c("Order_all", "Family_all", "Genus_all", "Species_all", "Compatibility_system", "Autonomous_selfing_level", "Flower_morphology",
          "Flower_symmetry", "life_form", "lifespan","Nectar_presence_absence")
t[cols] <- lapply(t[cols], factor)  ## as.factor() could also be used


cols.num <- c("Family_all","Genus_all","Species_all")
t[cols.num] <- sapply(t[cols.num],as.character)
t$Species_all <- gsub("Species_all_", "", t$Species_all)

t <- t[!t$Species_all == "Pinus luchuensis", ]   # remove gymnosperm species

#remove species that are not until species level
#ALL THE SPECIES WITH SP. ARE DELETD
t$Species_geonet <- gsub("M_PL_.*","",t$Species_geonet) #subsitute partial string for nothing
t$Species_geonet <- gsub(" $","", t$Species_geonet, perl=T) #remove trailing spaces
t$Species_geonet <-  sub('sp.1$', 'sp.', t$Species_geonet)#PREPARE ALL SP TO SP.
t$Species_geonet <- sub('sp.2$', 'sp.', t$Species_geonet)#PREPARE ALL SP TO SP.
t$Species_geonet <- sub('sp$', 'sp.', t$Species_geonet) #PREPARE ALL SP TO SP.
t$Species_geonet <- sub("sp.$", "DELETE", t$Species_geonet) #change all sp. for DELETE
t <- t[- grep("DELETE",  t$Species_geonet),] #remove species with "DELETE"
#CHECK LEVELS

#Make these NA's as NA
t$Species_all[t$Species_all=="NA"] <- NA
t$Family_all[t$Family_all=="NA"] <- NA
t$Genus_all[t$Genus_all=="NA"] <- NA
#remove NA's
t <- t[!is.na(t$Family_all),]
t <- t[!is.na(t$Species_all),]
t <- t[!is.na(t$Genus_all),]



missing.values <- t %>%
  gather(key = "key", value = "val") %>%
  mutate(isna = is.na(val)) %>%
  group_by(key) %>%
  mutate(total = n()) %>%
  group_by(key, total, isna) %>%
  summarise(num.isna = n()) %>%
  mutate(pct = num.isna / total * 100)

n_of_records <- subset(missing.values, isna=="FALSE")

Trait <- c("Plant height", "Flower width", "Flower length", "Inflorescence width", "Style length", "Ovules per flower",
           "Flowers per plant", "Microliters of nectar", "Milligrams of nectar", "Nectar concentration", "Pollen grains per flower", "Autonomous selfing (fruit set)")

Trait1 <- linebreak(c("Lifepan", "Life form", "Flower shape", "Flower symmetry", "Nectar", "Compatibility system", "Breeding system"),align = c("l"))

#T.cat <- linebreak(c("Short-lived \n Perennial", "Herb \n Shrub #\n Tree", "Brush \n Campanulate \n Capitulum \n Open \n #Papilionaceous \n Tube",  "Actinomorphic \n Zygomorphic",
#           "Presence \n Absence", "Self-incomp. \n Part. #self-comp. \n Self-comp.", "Hermaphrodite \n Monoecious \n #Dioecious"),align = c("l"))
#
T.cat <- linebreak(c("Short-lived and perennial", "Herb, shrub and tree", "Brush, campanulate, capitulum,\n open, papilionaceous and tube",  "Actinomorphic and zygomorphic",
           "Presence and absence", "Self-incompatible, partially self-compabtile \n and self-compatible", "Hermaphrodite, monoecious and dioecious"), align = c("l"))



Number_of_records_quantitative <- c(n_of_records$num.isna[n_of_records$key=="Plant_height_mean_m"], n_of_records$num.isna[n_of_records$key=="Corolla_diameter_mean"],
  n_of_records$num.isna[n_of_records$key=="Corolla_length_mean"], n_of_records$num.isna[n_of_records$key=="Floral_unit_width"],
  n_of_records$num.isna[n_of_records$key=="Style_length"], n_of_records$num.isna[n_of_records$key=="Ovule_number"],
  n_of_records$num.isna[n_of_records$key=="Flowers_per_plant"], n_of_records$num.isna[n_of_records$key=="Nectar_ul"],
  n_of_records$num.isna[n_of_records$key=="Nectar_mg"], n_of_records$num.isna[n_of_records$key=="Nectar_concentration"], n_of_records$num.isna[n_of_records$key=="Pollen_per_flower"],
  n_of_records$num.isna[n_of_records$key=="Autonomous_selfing_level_fruit_set"]) 


Number_of_records_categorical <- c(n_of_records$num.isna[n_of_records$key=="lifespan"], n_of_records$num.isna[n_of_records$key=="life_form"],
                                   n_of_records$num.isna[n_of_records$key=="Flower_morphology"], n_of_records$num.isna[n_of_records$key=="Flower_symmetry"],
                                   n_of_records$num.isna[n_of_records$key=="Nectar_presence_absence"], n_of_records$num.isna[n_of_records$key=="Autonomous_selfing_level"],
                                   n_of_records$num.isna[n_of_records$key=="Compatibility_system"], n_of_records$num.isna[n_of_records$key=="Breeding_system"],
                                   rep("",4))


T.range <- c("0.01-30m", "0.50-205mm", "0.20-195mm", "0.80-300mm", "0-138mm", "1-25000", "1-1.8 x $10^5$", "0-160$\\mu$l", "0-6.1mg", "0-100$\\%$", "13-2 x $10^8$", "0-100$\\%$")
  
dat_1 <- data.frame(Trait,T.range)
dat_2 <- data.frame(Trait1, T.cat)

colnames(dat_1) <- c("Quantitative traits", "Numerical range")
colnames(dat_2) <- c("Categorical traits", "Categories")

#kable(list(dat_1, dat_2), booktabs = T, linesep = #"\\addlinespace", escape = FALSE,caption = "\\textbf{Table 1 | #Quantitative and categorical traits used in this study.}") %>%
#  kable_styling(full_width = F,font_size = 10) %>%  #column_spec(1:4, 
#              width = "3in", 
#              latex_valign = "m")
#
#


colnames(dat_1) <- c("Traits", "Numerical range/Categories")
colnames(dat_2) <- c("Traits", "Numerical range/Categories")

d <- rbind(dat_1,dat_2)

kable(d, booktabs = T, linesep = "\\addlinespace", escape = FALSE,caption = "\\textbf{Table 1.} Quantitative and categorical traits used in this study.") %>%
  kable_styling(full_width = F,font_size = 12) %>% row_spec(0, bold=T) %>% pack_rows("Quantitative", 1, 12) %>%
pack_rows("Categorical", 13, 19) 



```

\doublespacing

## (d) Phylogenetic Distance

We calculated the phylogenetic distance between different plant species using the function *get_tree* from the package *rtrees* (<https://github.com/daijiang/rtrees>), which downloads phylogenetic distances from the extended R implementation of the Open Tree of Life [@smith2018; @jin2019].

## (e) Data Imputation

To avoid the loss of relevant ecological information, we imputed trait missing values with the help of the function *missForest* [@stekhoven2012] which allows imputation of datasets with continuous and categorical variables. We accounted for the phylogenetic distance among species on the imputation process by including the eigenvectors of a principal component analysis of the phylogenetic distance (PCoA) which has been shown to improve the performance of *missForest* [@penone2014]. To extract the eigenvectors, we used the function *PVRdecomp* from the package *PVR* [@santos2018] based on a previous conceptual framework that considers phylogenetic eigenvectors [@diniz-filho2012]. We conducted two different imputations, one for the full set of species (1,506 species, 5.79% of missing values) excluding nectar and pollen traits because of the high percentage of missing values (figure S2) and a second one for the subset of species with data for pollen per flower and microliters of nectar (755 species, 8.01% of missing values). To corroborate that our imputation of missing values did not affect our results, we evaluated the reproductive spectrum (see section below) with and without imputed values and we found consistent similar results on both analyses (Fig S3 and Fig S4).

## (f) Plant strategies

We explored the association between the different quantitative plant traits with a phylogenetically informed Principal Component Analysis (pPCA). We did not include the quantitative variables of flower length and inflorescence width because they were highly and moderately correlated to flower width respectively (Pearson's correlation = 0.72, *P* \< 0.01 and Pearson's correlation = 0.36, *P* \< 0.01), and thus we avoided overemphasizing flower size on the spectrum of trait variation. Prior to the analyses, we excluded outliers and standardized the data. Due to the high sensitivity of dimensionality reduction to outliers [@serneels2008; @legendre2012], we excluded values outside the 2.5th--97.5th percentile range, and thus our final dataset had 1,236 species. Then, we log transformed the variables to reduce the influence of outliers and z-transformed (X= 0, SD=1) so that all variables were within the same numerical range as recommended for principal component analysis [@legendre2012]. Although qualitative traits were not included in the dimensionality reduction analysis, we also investigated the statistical association of the different qualitative traits with the main axes of trait variation with the help of an Anova and a Tukey test. We performed the pPCA using the function *phyl.pca* from the package *phytools* [@revell2012] with the method lambda ($\lambda$) that calculates the phylogenetic correlation between 0 (phylogenetic independence) and 1 (shared evolutionary history) and we implemented the mode covariance because values for each variables were on the same scale following transformation [@abdi2010]. Finally, we conducted an additional phylogenetic informed principal component analysis for the subset of species with pollen and nectar quantity. For this, we included all quantitative traits considered in the main pPCA plus pollen grains and microlitres of nectar per flower.

## (g) Phylogenetic signal

We calculated the phylogenetic signal of the different quantitative traits on the imputed dataset with the full set of species (N = 1,506) with the package *phytools* [@revell2012] and we used Pagel's $\lambda$ as a measurement of the phylogenetic signal. However, for pollen and nectar traits, phylogenetic signal was calculated only on the subset of species that had quantitative information for these traits (N = 755).

## (h) Network analyses

### (i) Visitation patterns

First, we used Bayesian modelling (see below for details) to investigate how the different groups of floral visitors interacted along the main axes of reproductive trait variation with the help of qualitative and quantitative information of plant-pollinator interactions. For this, we used as qualitative information the binary version of the networks (presence-absence of interaction) that assumes equal weight across interactions and as quantitative information the number of visits of floral visitors to individual flowers that accounts for the intensity of the interaction. Although floral visitors are not always pollinators and number of visits does not consider each pollinator species efficiency [@ballantyne2015], the number of visits can provide valuable information of the contribution of floral visitors to pollination [@vazquez2005; @vazquez2012]. For this, we divided floral visitors into six main guilds that differ in life form, behaviour and are likely to play a similar ecological role: (i) bees (Hymenoptera-Anthophila), (ii) non-bee-Hymenoptera (Hymenoptera-non-Anthophila), (iii) syrphids (Diptera-Syrphidae), (iv) non-syrphid-Diptera (Diptera-non-Syrphidae), (v) Lepidoptera and (vi) Coleoptera. Moreover, because the guild of bees was the most represented group with 2,256 records and had the highest frequency of visits, we also explored presence-absence of the interaction and number of visits of the main bee families (Andrenidae, Apidae, Colletidae, Halictidae and Megachilidae) on the trait space. In addition, we found that *Apis mellifera* was the floral visitor with the largest proportion of records counted (7.55% of the total). This finding is consistent with previous research showing that *A. mellifera* was the most frequent floral visitor in a similar dataset of 80 plant-pollinator networks in natural ecosystems [@hung2018]. Hence, to control for the effect of *A. mellifera* on the observed visitation patterns of bees, we conducted an analogous analysis with presence-absence of the interaction and number of visits excluding *A. mellifera*. We found that *A. mellifera*, was partly driving some of the observed trends on PC1 (figure S5). However, we did not detect major differences on PC2 and PC3.

We implemented Bayesian generalized linear mixed models using the R package *brms* [@burkner2017]. We modelled presence-absence of observed interactions and number of visits as a function of the main axes of plant trait variation and their interactions with floral visitor guilds (e.g., number of visits \~ PC1 x FGs + PC2 x FGs + PC3 x FGs). Because we were interested in possible differences in the visitation patterns among floral visitors groups to plants with different strategies, we included interactions between the main axes of trait variation (PC1, PC2 and PC3) and the different floral visitor guilds. We added a nested random effect of networks nested within the study system to capture the variation in networks among studies and within networks. Moreover, we included the phylogenetic covariance matrix as a random factor due to the possible shared evolutionary histories of species and therefore lack of independence across them. We specified for presence-absence of interaction and number of visits a Bernoulli and a zero inflated negative binomial distribution, respectively. The models were run with 3,000 iterations with previous 1,000 warm up iterations and with non or very weakly informative priors from the brm function so they have neglible influence on the results [@burkner2017]. We set delta ($\Delta$) to 0.99 to avoid divergent transitions and visualized the posterior predictive checks with the function *pp_check* using the *bayesplot* package [@gabry2019].

### (ii) Plant species network roles

Second, we investigated with Bayesian modelling how the main axes of trait variation determined different plant species' functional roles in the pollination network. For this, we selected simple and complementary species-level network metrics commonly applied in bipartite network studies [@dormann2008] with a straightforward ecological interpretation relevant to our research goals. The different plant species-level metrics that summarize species' functional roles were: (i) sum of visits per plant species; (ii) normalized degree, calculated as the number of links per plant species divided by the total possible number of partners; and (iii) specialization (d') [@bluthgen2006], which measures the deviation of an expected random choice of the available interaction partners and ranges between 0 (maximum generalization) and 1 (maximum specialization). Normalized degree and specialization were calculated with the *specieslevel* function from the R package *bipartite* [@dormann2008]. We modelled the distinct plant species metrics (sum of visits, normalized degree and plant specialization) as a function of the three main axes of trait variation (plant species level metric \~ PC1 + PC2 + PC3). For each response variable (i.e., each plant species level metric), we used different distribution families (zero inflated negative binomial for the sum of visits, weibull for normalized degree and zero one inflated beta for specialization). Finally, we used the same random factors, model settings and conducted the same posterior predictive checks for each model as detailed above in the 'visitation patterns' section.

Analyses were conducted on the subset of 60 weighted networks sampled in a unique flowering season and site, which included 556 plant and 1,126 pollinator species. In total, our network dataset (excluding meta-webs and non-weighted networks) included 2,256 interactions of bees with plants, 1,768 non-syrphid-Diptera interactions, 845 syrphids interactions, 437 Lepidoptera interactions, 432 Coleoptera interactions and 362 non-bee-Hymenoptera interactions. Sampling methods varied across studies but this was accounted for in analyses by considering them in the random effects of the modelling process. All analyses were conducted in R version *4.0.3*.

# 3. Results

## (a) Plant strategies

The phylogenetically informed principal component analysis captured by the first two and three axes 51.8% and 70.97% of the reproductive trait variation, respectively (figure 1 and figure S6). The first principal component (PC1 or the flower number - flower size axis) represented 26.72% of the trait variation and indicated a negative correlation between flower number and flower size. The main contributing traits to PC1 were plant height, flower number, ovule number and flower size (loadings \> \|0.5\|; table S3) but style length also contributed moderately to PC1 (loading = -0.33). One end of this axis comprised species with high investment in flower number and plant height but small flower size, short style length and low ovule number. For instance, on this end of the spectrum we find the species *Cornus florida* which has approximately a total of 10.000 flowers, an average height of 7.5m, flowers of 3mm wide, a style length of 3.5mm and a total of 2 ovules per flower. The other end of this spectrum comprised species that were short in height and invested in large flowers, long styles, many ovules, but few flowers. For instance, on this other end, we find the species *Petunia axillaris* that has approximately 10 flowers per plant, a height of 0.5m, flowers over 50mm wide, styles of 25mm and over 200 ovules per flower. The second principal component (PC2 or the pollinator dependence axis) represented 25.05% of the trait variation and indicated the variation from low to high autonomous selfing, or in other words, high to low pollinator dependence, respectively. The main driver of trait variation on PC2 was autonomous selfing (loading = 0.85) but the other traits (except ovule number) also made moderate contributions (loadings from 0.27 to 0.4; table S3). In general terms, species with high pollinator dependence were associated with larger and a higher number of flowers, greater plant height and longer styles. On this extreme of the spectrum we find the species *Zuccagnia punctata* that is a self-incompatible shrub that depends completely on floral visitors for seed production, it has approximately 1500 flowers per plant, 3m height and a style length of 20mm. In contrast, species with low pollinator dependence tended to have fewer and smaller flowers, shorter plant height and shorter styles. As an example of this reproductive extreme, we find the species *Veronica peregrina* which is a self-compatible herb that is thought to be almost a complete selfer that relies none or little on floral visitors, it has around 20 flowers per plant, a height of 0.2m and a style length of 0.25mm. Further, the third principal component (PC3 or the style length - pollinator dependence axis) explained a considerable amount of trait variability (19.17%) and represented a negative correlation between style length (loading = -0.66) and pollinator dependence (autonomous selfing loading = \|-0.51\|) where species with short styles had high pollinator dependence and species with long styles low pollinator dependence. The remaining traits, apart from ovule number, were positively correlated with style length and negatively correlated with pollinator dependence (loadings from -0.23 to -0.46; table S3). In addition, the pPCA with the subset of species that had nectar and pollen quantity data showed that nectar quantity (microlitres of nectar per flower) and pollen grains per flower were positively associated with floral display. Floral rewards were specially strongly correlated with flower size but slightly correlated with flower number (figure S4). This pPCA explained similar variance with the first two principal components (45.52%) and similar associations of traits despite some variability in the loadings (table S4).

```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, out.width="85%", fig.height=10,fig.align='center',fig.width=10,fig.cap= "\\textbf{Figure 1.} Phylogenetically informed principal component analysis (pPCA) of 1,236 plant species from 28 plant-pollinator network studies. The solid arrows indicate the direction of the different quantitative traits (flower number, plant height, style length, flower size, ovule number and level of autonomous selfing) across the two main axes of trait variation. The length of the arrows indicate the weight of the variables on each principal component and the dashed lines show the opposed direction of trait variation. The icons at both ends of arrows and dashed lines illustrate the extreme form of the trait continuum."}

setwd("~/R_Projects/Reproductive Traits")

#Load libraries
library(viridis) #COLOUR GGPLOT
library(ggplot2)
library(broman) #crayon colours
library(cowplot)
library(magick)

# Theme for publication
theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
      theme(text=element_text(color="black"),
            axis.title=element_text( size = rel(1.75)),
            axis.text=element_text(size = rel(1.75), color = "black"),
            legend.title=element_text(face="bold"),
            legend.text=element_text(),
            legend.background=element_rect(fill="transparent"),
            legend.key.size = unit(1.2, 'lines'),
            panel.border=element_rect(color="black",size=1),
            panel.grid.minor.x =element_blank(),
            panel.grid.minor.y= element_blank(),
             panel.grid.major= element_blank()
      ))
}

#Load data
dat_cleaning_5 <- readRDS("Data/RData/data_all_species_PPCA.rds")
phyl_pca_forest <- readRDS("Data/RData/phyl_pca_forest.rds")


PC <- phyl_pca_forest
#CHECK CONTENT
#EIGENVALUES
PC$Eval
#PC score (POINTS)
PC$S
#PC loadings (ARROWS)
PC$L

#Images were made by Paula Martin
#Check her work on https://paulamartinart.com/

tree <- image_read("Images/PPCA_Plot/Tree.png")
tree_1 <- as.raster(tree)

style_l <- image_read("Images/PPCA_Plot/Style_Long.png")
style_l_1 <- as.raster(style_l)

style_s <- image_read("Images/PPCA_Plot/Style_Short.png")
style_s_1 <- as.raster(style_s)

ovule_h <- image_read("Images/PPCA_Plot/Ovule_High.png")
ovule_h_1 <- as.raster(ovule_h)

ovule_l <- image_read("Images/PPCA_Plot/Ovule_Low.png")
ovule_l_1 <- as.raster(ovule_l)

selfing_n <- image_read("Images/PPCA_Plot/Selfing_None.png")
selfing_n_1 <- as.raster(selfing_n)

selfing_h <- image_read("Images/PPCA_Plot/selfing.png")
selfing_h_1 <- as.raster(selfing_h)

single_flower <- image_read("Images/PPCA_Plot/Single_Flower.png")
single_flower_1 <- as.raster(single_flower)

many_flowers <- image_read("Images/PPCA_Plot/Inflorescencia.png")
many_flowers_1 <- as.raster(many_flowers)
#many_flowers_1 <- image_rotate(many_flowers, 45)


large_flower <- image_read("Images/PPCA_Plot/flower_big.png")
large_flower_1 <- as.raster(large_flower)

#"Images/PPCA_Plot/flower_short.png"
flower_small <- image_read("Images/PPCA_Plot/flower_big.png")
flower_small_1 <- as.raster(flower_small)

herb <- image_read("Images/PPCA_Plot/herb.png")
herb_1 <- as.raster(herb)

#############################################################################################################################################################
#COMPATIBILITY
#############################################################################################################################################################
#Load plots

#Invert axes
PC$S[,1] <- -PC$S[,1]
PC$S[,2] <- -PC$S[,2]


all_spp <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density


  
  plot <- plot+stat_density2d(aes(fill=..level..,alpha=..level..),geom='polygon') + 
  scale_fill_continuous(low="green",high="red",guide=FALSE,breaks = c(0.02, 0.050, 0.09), labels = c("Low", "Medium", "High")) + theme(legend.position = "none")+guides(fill = guide_legend(override.aes = list(alpha = 0.7),title="Kernel density"))+
    scale_alpha(guide = 'none')
  
  
    plot <- plot + geom_point(data=dat, aes(x, y),size=1.3, color="black")

  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .7 * mult * (get(x)),
                      v2 = .7 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.8, arrow=arrow(length=unit(0.5,"cm")), alpha=0.8, colour=c("black"))
  

  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=1.6, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.5, colour=c("black"))
  
   #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage
  
  plot <- plot + xlab(paste("Flower number - Flower size axis ", "(",(percentage[1]),"%",")", sep = "")) #XLAB
  plot <- plot + ylab(paste("Pollinator dependence - Floral display axis ", "(",(percentage[2]),"%",")", sep = "")) #YLAB
  

  #CHANGE THEME
    
  plot <- plot + theme_bw() + annotation_raster(tree_1, xmin = -4.1, xmax = -2.85,ymin = 2.05, ymax = 4.05)+
     annotation_raster(style_l_1, xmin = 2.25, xmax = 3.05,ymin = 2.55, ymax = 3.7) +
    annotation_raster(style_s_1, xmin = -2.6, xmax = -1.9,ymin = -2.65, ymax = -1.7) +
    annotation_raster(ovule_h_1, xmin = 3.5, xmax = 4.2,ymin = -0.45, ymax = 0.50) +
    annotation_raster(ovule_l_1, xmin = -4.2, xmax = -3.5,ymin = -0.45, ymax = 0.5) +
    annotation_raster(selfing_n_1, xmin = -0.75, xmax = 1.2,ymin = 2, ymax = 4.7) +
    annotation_raster(selfing_h_1, xmin = -0.30, xmax = 0.15,ymin = -3.9, ymax = -3.1) +
    annotation_raster(single_flower_1, xmin = 3.3, xmax = 4.1,ymin = -1.7, ymax = -0.7) +
    annotation_raster(many_flowers_1, xmin = -4.20, xmax = -3.40,ymin = 0.8, ymax = 1.45) +
    annotation_raster(large_flower_1, xmin = 3.18, xmax = 4.13,ymin = 1.3, ymax = 2.4) +
    annotation_raster(flower_small_1, xmin = -3.21, xmax = -2.81,ymin = -2, ymax = -1.45) +
    annotation_raster(herb_1, xmin = 2.6, xmax = 3,ymin = -2.8, ymax = -2) 


    
      #ADD LABELS
  rownames(PC$L) <- c("High selfing", "Many flowers", "Large flowers", "Long styles", "Many ovules", "Tall plants" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
 plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.7,5.05,5.6,7.85,7.3,6.15)), y = -(PCAloadings$PC2*c(4.693,2.5,3.1,6.6,5,5.5)+c(0,0,0,0,0.4,0)),
                         label = PCAloadings$Variables, color="black",fontface =2,size=4)
  
 
 plot <- plot + annotate("text", x = (PCAloadings$PC1*c(4.6,4.95,4.5,6.6,7.3,5.15)), y = (PCAloadings$PC2*c(3.83,6.4,5.7,7.4,-1,7.45)+c(0,0,0,0,-0.41,0)),
                         label =c("Low selfing", "Few flowers", "Small flowers", "Short styles", "Few ovules", "Short plants" ), color="black",fontface =2,size=4)
 
 
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.095, 0.11)) +ggtitle("") 
  
  
  
  plot
  
}

plot_grid(all_spp(PC))



```

We found that most categorical traits were statistically associated with the first two axes of trait variation (figure 2 and table S2). Flower symmetry, which was only associated with PC2 (Sum of squares = 8.51, F-value = 14.72, *P* \< 0.01 ), and nectar provision, which was independent of PC1 and PC2 (PC1: Sum of squares = 0.37, F-value = 0.29 , *P* = 0.59; PC2: Sum of squares = 0.83, F-value = 1.43, *P* = 0.23) showed lack of statistical association. In addition, we found statistical differences between the different levels of categorical traits in the trait space (figure S7). Regarding self-compatibility, we found larger differences on PC2. For instance, species with unisexual flowers that were self-incompatible were statistically differentiated from species with partial or full self-compatibility on this vertical axis (figure S7a and figure S7b; Tukey test *P* \< 0.05). Life forms differed statistically across both axes of trait variation and followed a gradient of larger life forms (trees and shrubs) with higher pollinator dependence to smaller ones (herbs) with lower pollinator dependence (figure S7c and figure S7d; Tukey test *P* \< 0.05). Consequently, lifespan also followed this gradient but perennial and short lived species only differed statistically on PC2 (figure S7e and figure S7f; Tukey test *P* \< 0.05). Species with unisexual flowers (monoecious and dioecious) were clustered on both extremes of the first two principal components and had the highest pollinator dependence and highest number of flowers (figure S7g and figure S7h; Tukey test *P* \< 0.05). Moreover, we found that the campanulate and capitulum flower shapes were differentiated from tube, papilionaceous, open and brush shapes in the trait space. The former morphologies had larger flowers and greater pollinator dependence, while the latter had higher flower number and lower pollinator dependence (figure S7i and figure S7j; Tukey test *P* \< 0.05). Regarding flower symmetry, zygomorphic flowers were associated with lower levels of pollinator dependence, whereas actinomorphic flowers had higher levels of pollinator dependence (figure S7k and figure S7l; Tukey test *P* \< 0.05).

\blandscape

```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=12, fig.width=18, out.width="80%",fig.align='center',fig.cap= "\\textbf{Figure 2.} Location of the different qualitative traits on the trait space. The panel is composed by the traits that showed statistical association with the first two axes of trait variation: compatibility system (a), life form (b), lifespan (c), breeding system (d), flower shape (e) and flower symmetry (f). The solid arrows indicate the direction of variation of the different quantitative traits showed in figure 1: flower number (FN), plant height (PH), style length (SL), flower size (FS), ovule number (ON) and the level of autonomous selfing (S)."}


#Set working directory
setwd("~/R_Projects/Reproductive Traits")

#Load libraries
#LOAD LIBRARIES
library(phytools)
library(ape) #for phylogenetic distance
library(dplyr) #data processing
library(rtrees) #for phylogenetic distancelibrary(MASS)
library(reshape2)
library(viridis) #COLOUR GGPLOT
library(MASS)
library(ggplot2)
library(broman) #crayon colours
library(cowplot)

# Theme for publication
theme_ms <- function(base_size=12, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
      theme(text=element_text(color="black"),
            axis.title=element_text( size = rel(1.6)),
            axis.text=element_text(size = rel(1.6), color = "black"),
            legend.title=element_text(face="bold"),
            legend.text=element_text(size = rel(1.1)),
            legend.background=element_rect(fill="transparent"),
            legend.key.size = unit(0.4, 'lines'),
            panel.border=element_rect(color="black",size=1),
            panel.grid.minor.x =element_blank(),
            panel.grid.minor.y= element_blank(),
             panel.grid.major= element_blank(),
            plot.title = element_text(size = rel(2.5), face="bold")
      ))
}

#Load data
dat_cleaning_5 <- readRDS("Data/RData/data_all_species_for_rmd_plot_ppca_QUALITATIVE.rds")
phyl_pca_forest <- readRDS("Data/RData/phyl_pca_forest.rds")

#CALL the output PC for simplicity
PC <- phyl_pca_forest
#CHECK CONTENT
#EIGENVALUES
PC$Eval
#PC score (POINTS)
PC$S
#PC loadings (ARROWS)
PC$L

#############################################################################################################################################################
#COMPATIBILITY
#############################################################################################################################################################
#Load plots
Compatibility <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$Compatibility <- dat_cleaning_5$Compatibility_system
  dat$Compatibility <- as.character(dat$Compatibility)
  dat$Compatibility[dat$Compatibility=="dioecious"] <- "Unisexual flowers"
  dat$Compatibility[dat$Compatibility=="monoecious"] <- "Unisexual flowers"
  dat$Compatibility[dat$Compatibility=="partially_self_compatible"] <- "Partially self compatible"
  dat$Compatibility[dat$Compatibility=="self_compatible"] <- "Self compatible"
  dat$Compatibility[dat$Compatibility=="self_incompatible"] <- "Self incompatible"
  dat$Compatibility <- factor(dat$Compatibility, levels = c("Self compatible", "Partially self compatible", "Self incompatible", "Unisexual flowers"))

  plot <- plot + geom_point(data=dat, aes(-x, -y, colour=Compatibility),size=1.75)+scale_color_manual(values=c("cyan4", "deepskyblue2","orange","gray7"))
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.220, 0.130)) +ggtitle("(a)") + xlab(NULL)  + ylab("Pollinator dependence - Floral display axis")
  
  
  plot
  
}

#Compatibility(PC)

#############################################################################################################################################################
#Life form
#############################################################################################################################################################
#Load plots
Life_form <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Life form` <- dat_cleaning_5$life_form
  dat$`Life form` <- as.character(dat$`Life form`)
  dat$`Life form`[dat$`Life form`=="herb"] <- "Herb"
  dat$`Life form`[dat$`Life form`=="shrub"] <- "Shrub"
  dat$`Life form`[dat$`Life form`=="tree"] <- "Tree"
  dat$`Life form`[dat$`Life form`=="vine"] <- "Shrub"
  
  dat$`Life form` <- factor( dat$`Life form`, levels = c("Herb", "Shrub", "Tree"))

  plot <- plot + geom_point(data=dat, aes(-x, -y, colour=`Life form`),size=1.75)+scale_color_manual(values=c("forestgreen", "darkorange2","gray7"))
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.090, 0.115)) + ggtitle("(b)") +
    xlab(NULL) + ylab(NULL)
  
  plot
  
}

#Life_form(PC)


#############################################################################################################################################################
#Life span
#############################################################################################################################################################
#Load plots
Life_span <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
    dat$Lifespan <- dat_cleaning_5$lifespan
    dat$Lifespan <- as.character(dat$Lifespan)

  plot <- plot + geom_point(data=dat, aes(-x, -y, colour=Lifespan),size=1.75)+scale_color_manual(values=c("sienna4","forestgreen"))
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.12, 0.1)) + ggtitle("(c)") +
    xlab(NULL) + ylab(NULL)
  
  plot
  
}

#Life_span(PC)


#############################################################################################################################################################
#Flower symmetry
#############################################################################################################################################################
#Load plots
Flower_sym <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Flower symmetry` <- dat_cleaning_5$Flower_symmetry
  dat$`Flower symmetry` <- as.character(dat$`Flower symmetry`)
  dat$`Flower symmetry`[dat$`Flower symmetry`=="actinomorphic"] <- "Actinomorphic"
  dat$`Flower symmetry`[dat$`Flower symmetry`=="zygomorphic"] <- "Zygomorphic"
  

  plot <- plot + geom_point(data=dat, aes(-x, -y, colour=`Flower symmetry`),size=1.75)+scale_color_manual(values=c("sienna2","purple"))
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.155, 0.1)) + ggtitle("(f)") + ylab(NULL) + xlab("Flower number - Flower size axis")
  
  plot
  
}

#Flower_sym(PC)


#############################################################################################################################################################
#Flower shape
#############################################################################################################################################################
#Load plots
Flower_sha <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Flower shape` <- dat_cleaning_5$Flower_morphology
  dat$`Flower shape` <- as.character(dat$`Flower shape`)
  dat$`Flower shape`[dat$`Flower shape`=="Funnelform"] <- "Campanulate"
  dat$`Flower shape`[dat$`Flower shape`=="Spike"] <- "Brush"

  plot <- plot + geom_point(data=dat, aes(-x, -y, colour=`Flower shape`),size=1.75)+scale_color_manual(values=c("blue","cyan4", "red","forestgreen","purple","gold"))
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  
  #CHANGE THEME
  
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.155, 0.17)) + ggtitle("(e)") + ylab(NULL) + xlab("Flower number - Flower size axis")
  
  plot
  
}

#Flower_sha(PC)


#############################################################################################################################################################
#Breeding system
#############################################################################################################################################################
#Load plots
Breeding_syst <- function(PC, x="PC1", y="PC2") {
  # PC being a prcomp object
  data <- data.frame(PC$S)
  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
  dat <- data.frame(x = data[,x], y = data[,y])
  
  #######
  #DENSITY FUNCTION
  #######
  get_density <- function(x, y, ...) {
    dens <- MASS::kde2d(x, y, ...)
    ix <- findInterval(x, dens$x)
    iy <- findInterval(y, dens$y)
    ii <- cbind(ix, iy)
    return(dens$z[ii])
  }
  
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
  dat$`Breeding system` <- dat_cleaning_5$Breeding_system
  dat$`Breeding system` <- as.character(dat$`Breeding system`)
  dat$`Breeding system` <- factor(dat$`Breeding system`, levels=c("Hermaphrodite","Monoecious" ,"Dioecious"))

  plot <- plot + geom_point(data=dat, aes(-x, -y, colour=`Breeding system`),size=1.75)+scale_color_manual(values=c("forestgreen","orange", "black"))
  
  ########
  #ADD ARROWS 
  ########
  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
  mult <- min(
    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
  )
  datapc <- transform(datapc,
                      v1 = .75 * mult * (get(x)),
                      v2 = .75 * mult * (get(y))
  )
  # add arrows
  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, yend=-v2),size=1.2, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
  
  #Add axis with perctentage
  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage

  
  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.8, arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
  
  #ADD LABELS
  rownames(PC$L) <- c("S", "FN", "FS", "SL", "ON", "PH" )
  
  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,5.2,5.25,7.9,7.1,6)), y = -(PCAloadings$PC2*c(4.45,4.2,5.4,7.7,6,6.5)+c(0,0,0,0,-0.1,0)),
                          label = PCAloadings$Variables, color="black",size=6, fontface=2)
  

  
  #CHANGE THEME
  #CHANGE THEME
  
  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.152, 0.11)) + ggtitle("(d)") +
    xlab("Flower number - Flower size axis") +
    ylab("Pollinator dependence - Floral display axis")
  
  plot
  
}

#Breeding_syst(PC)

#############################################################################################################################################################
#Nectar
#############################################################################################################################################################
#Load plots
#Nectar <- function(PC, x="PC1", y="PC2") {
#  # PC being a prcomp object
#  data <- data.frame(PC$S)
#  plot <- ggplot(data, aes_string(x=x, y=y)) #generate plot
#  dat <- data.frame(x = data[,x], y = data[,y])
#  
#  #######
#  #DENSITY FUNCTION
#  #######
#  get_density <- function(x, y, ...) {
#    dens <- MASS::kde2d(x, y, ...)
#    ix <- findInterval(x, dens$x)
#    iy <- findInterval(y, dens$y)
#    ii <- cbind(ix, iy)
#    return(dens$z[ii])
#  }
#  
#  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
#  dat$density <- get_density(dat$x, dat$y, h = c(2, 2), n = 1000) #obtain density
#  dat$Nectar <- dat_cleaning_5$Nectar_presence_absence
#  dat$Nectar[dat$Nectar=="yes"] <- "Presence"
#  dat$Nectar[dat$Nectar=="no"] <- "Absence"
#  plot <- plot + geom_point(data=dat, aes(-x, -y, #colour=Nectar),size=1.75)+scale_color_manual(values=c("black","grey"))
#  
#  ########
#  #ADD ARROWS 
#  ########
#  datapc <- data.frame(PC$L) #CREATE DATAFRAME WITH LOADINGS
#  mult <- min(
#    (max(data[,y]) - min(data[,y])/(max(datapc[,y])-min(datapc[,y]))),
#    (max(data[,x]) - min(data[,x])/(max(datapc[,x])-min(datapc[,x])))
#  )
#  datapc <- transform(datapc,
#                      v1 = .75 * mult * (get(x)),
#                      v2 = .75 * mult * (get(y))
#  )
#  # add arrows
#  plot <- plot + geom_segment(data=datapc,linejoin="round", lineend="round",aes(x=0, y=0, xend=-v1, #yend=-v2),size=1, arrow=arrow(length=unit(0.5,"cm")), alpha=1, color="black")
#  
#  #Add axis with perctentage
#  percentage <- round(diag(PC$Eval) / sum(PC$Eval) * 100, 2) #calculate percentage
#
#  
#  #ADD THE OTHER DIRECTION OF THE SEGMENT BECAUSE LOOKS COOL
#  plot <- plot + geom_segment(data=datapc, aes(x=0, y=0, xend=v1, yend=v2),size=0.6, #arrow=arrow(length=unit(0,"cm")),linetype=2, alpha=0.8, color="black")
#  
#  #ADD LABELS
#  rownames(PC$L) <- c("Selfing", "Flower N.", "Flower size", "Style Length", "Ovule N.", "Plant Height" )
#  
#  PCAloadings <- data.frame(Variables = rownames(PC$L), PC$L)
#  plot <- plot + annotate("text", x = -(PCAloadings$PC1*c(4.6,4.95,5,7.5,7.1,6)), y = #-(PCAloadings$PC2*c(4.3,2.6,5,7,5.8,6.5)+c(0,0,0,0,-0.15,0)),
#                          label = PCAloadings$Variables, color="black",size=3)
#  
#  #CHANGE THEME
#  #CHANGE THEME
#  
#  plot <- plot + theme_ms() +ylim(-4,4) + xlim(-4,4) +  theme(legend.position = c(0.095, 0.115)) + ggtitle("G)") 
#  
#  plot
#  
#}
#
# #plot_grid(Compatibility(PC),Life_form(PC),Life_span(PC),Breeding_syst(PC),Flower_sha(PC),Flower_sym(PC),Nectar(PC), ncol=2,nrow=4,  align = "hv")

  plot_grid(Compatibility(PC),Life_form(PC),Life_span(PC),Breeding_syst(PC),Flower_sha(PC),Flower_sym(PC),ncol=3,nrow=2,  align = "hv")


```

\elandscape

## (b) Phylogenetic signal

We found a strong phylogenetic signal (*P* \< 0.01) for most quantitative traits (table S5). The traits that showed the highest phylogenetic signal were ovule number ($\lambda$ = 1), pollen grains per flower ($\lambda$ = 1) and plant height ($\lambda$ = 0.96), followed by flower length ($\lambda$ = 0.75), flower width ($\lambda$ = 0.73), number of flowers per plant ($\lambda$ = 0.69) and nectar concentration ($\lambda$ = 0.65). The traits that showed a moderate phylogenetic signal were inflorescence width ($\lambda$ = 0.57), style length ($\lambda$ = 0.49) and autonomous selfing ($\lambda$ = 0.34). Finally, microliters of nectar per flower showed the lowest phylogenetic signal of all traits ($\lambda$ = 0.14).

## (c) Visitation patterns

The main axes of trait variation (PC1, PC2 and PC3) explained partly presence-absence of interaction partners (conditional $R^{2}$ = 0.26; marginal $R^{2}$ = 0.20) but little of the overall number of visits (conditional $R^{2}$ = 0.31; marginal $R^{2}$ = 0.06). However, we found relevant differences across the different floral visitor guilds on both presence-absence of interactions and number of visits (figure 3). We found on the flower number - flower size axis that plants with high flower number and small flowers had higher interaction partners of Coleoptera, non-bee-Hymenoptera and all Diptera guilds (figure 3a) but plants with low flower number but large flowers had higher interaction partners of bees and Lepidoptera guilds. Regarding visitation rates on the flower number - flower size axis, we found similar trends but bees and syrphids guilds in this case showed higher number of visits to plant species with high number of small flowers (figure 3d). On the pollinator dependence axis, we found that all plant species with higher pollinator dependence had higher number of interacting partners and number of visits from all floral visitor guilds (figure 3b and figure 3e). Finally, on the style length - pollinator dependence axis plant species with short styles and high pollinator dependence had higher interaction partners of all guilds but bees, that interacted clearly more with plant species with long styles and low pollinator dependence (figure 3c). Plants with long styles and high selfing interacted more frequently with Lepidoptera and non-bee-Hymenoptera guilds (figure 3f).

The additional model for the most represented families of bees for both presence-absence of interaction (marginal $R^{2}$ = 0.29; conditional $R^{2}$ = 0.19) and number of visits (marginal $R^{2}$ = 0.30; conditional $R^{2}$ = 0.03) showed that the family Apidae was the main driver of the observed patterns. The contrasting differences between presence-absence of interaction and number of visits for bees on PC1 (figure 3a and figure 3d) were driven by the family Andrenidae that had higher number of interacting partners but lower number of visits on plant species with low number of large flowers (figure S8).

```{=tex}
\vspace{5mm}
\blandscape
```
```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=14, fig.width=27,fig.cap= "**Figure 3.** Fitted posterior estimates of the presence-absence of interaction (a, b and c) and number of visits (d, e and f) of the different floral visitor guilds in relation to the main axes of trait variation (PC1, PC2 and PC3). PC1 represents the flower number - flower size axis, PC2 represents the pollinator dependence axis and PC3, the style length - pollinator dependence axis. For visualization purposes, due to large differences between number of visits of bees and the rest of guilds, the number of visits was log-transformed (Y-axis of lower panel)."}

#LOAD LIBRARIES 
#library(phytools)
#library(ape) #for phylogenetic distance
#library(dplyr) #data processing
#library(rtrees) #for phylogenetic distancelibrary(MASS)
#library(reshape2)
library(viridis) #COLOUR GGPLOT
#library(MASS)
library(ggplot2)
library(broman) #crayon colours
#library(tidyverse)
library(patchwork) #panel of plots
#library(brms)
#library(cmdstanr)

#Load theme for publication

theme_ms <- function(base_size=14, base_family="Helvetica") {
  (theme_bw(base_size = base_size, base_family = base_family)+
     theme(text=element_text(color="black"),
           axis.title=element_text( size = rel(2)),
           axis.text=element_text(size = rel(1.8), color = "black"),
           legend.title=element_text(face="bold",size=rel(2)),
           legend.text=element_text(size=rel(1.4)),
           legend.background=element_rect(fill="transparent"),
           legend.key.size = unit(2, 'lines'),
           panel.border=element_rect(color="black",size=2.4),
           panel.grid.minor.x =element_blank(),
           panel.grid.minor.y= element_blank(),
           panel.grid.major= element_blank(),
           plot.title = element_text(hjust = 0.5,size=rel(2.75),face="bold"),
           plot.subtitle = element_text(face="bold",size=rel(2))
     ))
}


setwd("~/R_Projects/Reproductive Traits")


p1 <- readRDS("Main_Figures/figure_3_1.rds")
p2 <- readRDS("Main_Figures/figure_3_2.rds")
p3 <- readRDS("Main_Figures/figure_3_3.rds")
pp1 <- readRDS("Main_Figures/figure_3_4.rds")
pp2 <- readRDS("Main_Figures/figure_3_5.rds")
pp3 <- readRDS("Main_Figures/figure_3_6.rds")

library(patchwork)

combined <- pp1 + pp2 + pp3 + p1 + p2 + p3 & theme(legend.position = "bottom")
combined + plot_layout(guides = "collect",ncol = 3)

```

\elandscape

## (d) Plant species network roles

The variance of the different plant species-level network metrics was poorly explained by the three main axes of trait variation (figure S9; number of visits \~ PCs, conditional $R^{2}$ = 0.11, marginal $R^{2}$ = 0.02; normalized degree \~ PCs, conditional $R^{2}$ = 0.24, marginal $R^{2}$ = 0.02; and, specialization \~ PCs, conditional $R^{2}$ = 0.37, marginal$R^{2}$ = 0.03). Overall, the most notable trends were found on the flower number - flower size axis (PC1) and the style length - pollinator dependence axis (PC3) for number of visits and specialization. On PC1, the number of visits was higher for plant species with more flowers but was lower for plant species with larger flowers (figure S9a). However, specialization showed the opposite trend on this axis (figure S9g). On PC3, the number of visits was lower for plants with shorter styles and higher pollinator dependence but higher for plant species with longer styles and lower pollinator dependence (figure S9c). Again, specialization showed the opposite trend to number of visits (figure S9i).

# 4. Discussion

The reproductive spectrum of flowering plants showed clear reproductive trait covariation patterns that shaped interactions with floral visitors at a global scale. Despite the enormous variability of plant reproductive structures, the first two and three axes were able to capture over 50% and 70% of reproductive trait variation, respectively. These three axes were: (1) the flower number - flower size, (2) the pollinator dependence - floral display and (3) the style length - pollinator dependence. Although the explained trait variation that we found in the first two axes is lower than previous studies that consider only morphological and physiological traits [@diaz2016; @carmona2021], our results are consistent with the largest and most recent study that has characterised plant life strategies including reproductive and plant form and size related traits [@salguero2016]. Interestingly, the different plant reproductive axes were able to partly explain the number of interacting partners of different floral visitor guilds. However, they were insufficient to capture the visitation rates by guild or the other species-level network metrics considered in this study, which highlights the need to account for other local factors, such as species relative abundances [@bartomeus2016], to better understand the association of plant-pollinator interactions at a macroecological scale.

Our study provides solid evidence for several widely discussed trait associations with the help of a great diversity of phylogenetic lineages (170 families and over 1200 species) within a multitrait context and links the reproductive spectrum with the previously described fast-slow continuum' in plant [@salguero2016] and animal [@healy2019] life-history strategies, as indicated by the different reproductive traits associated with the traits of plant height, life form and lifespan. For instance, although the negative correlation between flower number and flower size has received substantial attention [@worley2000; @sargent2007; @kettle2011], it has only been investigated across a few hundred Angiosperm species with a pair-wise trait approach. We found support to this trait association and show that other life history traits also covariate along this axis. Our study also complements previous evidence that links breeding systems and life forms [@petit2006; @friedman2020] by showing that most species with unisexual flowers are associated with woody life forms with high flower number. Moreover, we also provide broad support for the previously documented positive association between outcrossing rate and floral display [@goodwillie2010] where species with high pollinator dependence have greater allocation of resources to attract floral visitors. Despite floral rewards not being included in the main analysis because there was insufficient data available, both pollen and nectar quantity were clearly associated with plant species with larger floral displays but in particular with species with larger flowers. Our results highlight the presence of worldwide reproductive trait covariation patterns across flowering plants that are likely to impose constraints to the global spectrum of plant trait variation.

Overall, plant reproductive trait covariation axes helped explain observed interaction patterns among and within floral visitor guilds suggesting that plant reproductive strategies partly mediate these associations at large ecological scales. For example, we found that all floral visitor guilds interacted more frequently with plant species with larger flowers and higher pollinator dependence in agreement with previous findings [@hegland2005; @lazaro2013; @kaiser2014]. As predicted by evolutionary life-history theory [@stebbins1970], larger investment on floral display and rewards to attract pollinators makes sense when pollinator dependence is higher, but this investment is compromised by the cost of the different reproductive structures, trait associations and the distinct selective pressures such as the one exerted by the different floral visitor guilds [@galen1999]. For instance, smaller flowers were less visited overall, but they are inexpensive (e.g., low ovule number) and can counterpart this lack of visitation at the flower level by increasing the chances of visitation at the whole individual level with larger displays as suggested for wind pollinated species where small numerous flowers can increase the chances of pollen capture and seed production [@friedman2011]. In addition, because plants can adapt to the most efficient floral visitors [@fenster2004], the different associations found between reproductive traits and floral visitor guilds also may indicate the existence of large scale pollination syndromes [@faegri2013; @rosas2014; @dellinger2020]. For instance, bees and syrphid flies were clearly associated with opposing plant reproductive strategies on all axes and because these two guilds are likely to differ in ecology and behaviour [@rader2020; @foldesi2021] they may exert different selective pressures that lead to divergent plant reproductive strategies. In any case, it is worth noting that other local factors such as species relative abundances, phenology or trait matching, surely explain part of the observed variability [@vazquez2007; @encinas2012; @bartomeus2016] that reproductive trait correlations do not.

Our study provides a robust description of the main reproductive trait covariation patterns of flowering plants by using a global dataset of reproductive traits from plant species that belong to plant-pollinator networks. Additionally, we highlight the relevance of floral visitors in mediating these reproductive trait correlations and the need to consider factors such as plant reproductive strategies, and not only flower morphology, to better capture broad scale patterns of interactions with floral visitors. Further, we provide empirical evidence that complements previous trait correlation studies along other plant organs and we highlights the need to include reproductive trait correlations in the global spectrum of plant form and function [@diaz2016], as the different plant reproductive strategies involve clear cost and benefits that can affect resource allocation to other morphological and physiological traits. Finally, the future incorporation of unrepresented areas of the world and other relevant reproductive traits such as flower life span or flower colour will definitely help to provide better descriptions of the reproductive spectrum of plant trait variation and understanding of the different plant-pollinator associations.

# References

::: {#refs}
:::

**Data accessibility.** All data and code used to conduct this study are available in the online repositories of Zenodo (<https://doi.org/10.5281/zenodo.6705621>) and Github (<https://github.com/JoseBSL/Reproductive-traits>).

**Authors' contributions.** JBL, RR and IB designed the study. JBL collated the data and conducted analysis with guidance of JS, LKK and IB. JBL wrote the manuscript with contributions of all authors.

**Conflict of interest declaration.** We declare we have no competing interests.

**Funding.** This study was supported by the European project SAFEGUARD (101003476 H2020-SFS-2019-2) and JBL was supported by a University of New England IPRA postgraduate scholarship.

**Acknowledgements.** We thank all researchers that made their data openly available and sent it upon request. We also thank Bryony Wilcox, Greg Bible, Mercedes Sanchez-Lanuza and David Ragel for their help with data collection. We also thank Jason Tylianakis for his comments on the manuscript before submission. Finally, we thank Marcos Méndez, Susan Kalisz, Amanda Benoit, May Berenbaum and an anonymous reviewer for thoughtful feedback and useful comments on earlier versions of this manuscript.
