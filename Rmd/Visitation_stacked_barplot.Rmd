---
title: "Visitation_stacked_barplot"
output:
  pdf_document: default
  html_document: default
---


```{r, echo=FALSE, message=FALSE, cache=FALSE, results='hide', warning=FALSE, fig.height=7, fig.width=8}
library(dplyr)
library(tidyr)
library(plyr)
library(ggplot2)
library(reshape2)
library(scales)
library(devtools)
library(png)
library(grid)
library(gridExtra)
library(jpeg)
dev_mode(on=T)

setwd("~/R_Projects/Reproductive Traits")

img <- readPNG(system.file("img", "Rlogo.png", package="png"))
g <- rasterGrob(img, interpolate=TRUE)


net_long_1 <- readRDS("Data/RData/Spp_visitation_per_order_long.RData")

la <- c("Bartomeus unp. 2015", "Chacoff 2011","Bartomeus 2008 1", "Bartomeus 2008 2","Small 1976",
       "Inouye 1990", "Souza 2018", "Inouye 1988", "Dupont 2009", "Olesen 2002 1", "Fang huang 2012", "Olesen 2002 2", "Dicks 2002",
       "Elberling 1999","Kato 2000", "Kaiser-Bunbunry 2009", "Traveset 2013", "Kaiser-Bunbury 2014","Lundgren 2005")
legend_title <- "Taxonomic groups"


 get_png <- function(filename) {
  grid::rasterGrob(png::readPNG(filename), interpolate = TRUE)
}


 
l <- get_png("Images/lepidoptera_2.png")
bumb <- get_png("Images/bumblebee.png")
dip <- get_png("Images/diptera.png")
beet <- get_png("Images/beetle.png")
hem<- get_png("Images/hemiptera.png")

t <- grid::roundrectGrob(x=0.5, y=0.5, width=1, height=1)


p<- ggplot(net_long_1) +
  aes(x = reorder(Id,-order), 
      y = measurement, 
      fill =factor(orders, levels=c("Hemiptera","Coleoptera","Lepidoptera","Diptera", "Hymenoptera"))) +
  geom_bar(position = "fill", stat = "identity", alpha=0.6) +coord_flip() +scale_x_discrete(labels= la) + 
  scale_fill_manual(legend_title,values=c("indianred", "gray49", "seagreen", "darkgoldenrod2", "#386cb0")) + theme_classic()+xlab("Networks")+ylab("Percentage of visits") +scale_y_continuous(labels = scales::percent) + theme(legend.background = element_rect(fill=alpha('blue', 0.0)))+
  annotation_custom(l, xmin = 9.365, xmax = 10.0, ymin = 1.03, ymax =1.09) + annotation_custom(bumb, xmin = 7.1, xmax = 9.3, ymin = 1.03, ymax =1.09)+ annotation_custom(dip, xmin = 8.65, xmax = 9.25, ymin = 1.035, ymax =1.085)+
  coord_cartesian(clip = "off") + annotation_custom(beet, xmin = 9.96, xmax = 10.76, ymin = 0.86, ymax =1.255)+ annotation_custom(hem, xmin = 10.86, xmax = 11.36, ymin = 0.883, ymax =1.233)+
  coord_cartesian(clip = "off")+ coord_flip()+coord_cartesian(clip = "off")
 

gg_table <- ggplot_gtable(ggplot_build(p))
gg_table$layout$clip[gg_table$layout$name=="panel"] <- "off"
grid.draw(gg_table)



#Bumblebee image credit to Melissa Broussard
```

